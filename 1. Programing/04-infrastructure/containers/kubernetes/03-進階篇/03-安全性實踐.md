# 03-å®‰å…¨æ€§å¯¦è¸

> RBAC æ¬Šé™æ§åˆ¶ã€NetworkPolicy ç¶²çµ¡éš”é›¢ã€Pod Security èˆ‡å¯†é‘°ç®¡ç†

---

## ğŸ“š æœ¬ç« ç›®æ¨™

- æŒæ¡ RBAC æ¬Šé™ç®¡ç†
- å¯¦ç¾ NetworkPolicy ç¶²çµ¡éš”é›¢
- é…ç½® Pod Security Standards
- å®‰å…¨ç®¡ç† Secretsï¼ˆSealed Secrets/Vaultï¼‰
- é¡åƒå®‰å…¨æƒæèˆ‡æ¼æ´ç®¡ç†
- å¯¦æ–½å¯©è¨ˆèˆ‡åˆè¦

---

## 1. RBAC æ¬Šé™æ§åˆ¶

### 1.1 RBAC æ ¸å¿ƒæ¦‚å¿µ

```mermaid
graph TB
    subgraph "RBAC çµ„ä»¶"
        SA[ServiceAccount<br/>æœå‹™å¸³è™Ÿ]
        Role[Role/ClusterRole<br/>è§’è‰²]
        RB[RoleBinding/ClusterRoleBinding<br/>ç¶å®š]
    end
    
    subgraph "æ¬Šé™ç¯„åœ"
        NS[Namespace ç´šåˆ¥<br/>Role + RoleBinding]
        CL[é›†ç¾¤ç´šåˆ¥<br/>ClusterRole + ClusterRoleBinding]
    end
    
    SA --> RB
    Role --> RB
    RB --> NS
    
    SA --> CRB[ClusterRoleBinding]
    Role --> CRB
    CRB --> CL
    
    style SA fill:#9cf
    style Role fill:#fc9
    style RB fill:#f9c
```

### 1.2 ServiceAccount ç®¡ç†

**å‰µå»º ServiceAccountï¼š**
```yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: webapp-sa
  namespace: production
automountServiceAccountToken: false
```

**Pod ä½¿ç”¨ ServiceAccountï¼š**
```yaml
apiVersion: v1
kind: Pod
metadata:
  name: webapp
spec:
  serviceAccountName: webapp-sa
  automountServiceAccountToken: true
  
  containers:
  - name: app
    image: myapp:v1.0
```

### 1.3 Role èˆ‡ ClusterRole

**Namespace ç´šåˆ¥ Roleï¼š**
```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: pod-reader
  namespace: production
rules:
- apiGroups: [""]
  resources: ["pods"]
  verbs: ["get", "list", "watch"]

- apiGroups: [""]
  resources: ["pods/log"]
  verbs: ["get"]
```

**é›†ç¾¤ç´šåˆ¥ ClusterRoleï¼š**
```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: secret-reader
rules:
- apiGroups: [""]
  resources: ["secrets"]
  verbs: ["get", "list"]
  
- apiGroups: [""]
  resources: ["configmaps"]
  verbs: ["get", "list", "watch"]
```

**å¸¸ç”¨æ¬Šé™å‹•è©ï¼š**
- `get` - ç²å–å–®å€‹è³‡æº
- `list` - åˆ—å‡ºè³‡æº
- `watch` - ç›£è½è³‡æºè®ŠåŒ–
- `create` - å‰µå»ºè³‡æº
- `update` - æ›´æ–°è³‡æº
- `patch` - éƒ¨åˆ†æ›´æ–°
- `delete` - åˆªé™¤è³‡æº
- `deletecollection` - æ‰¹é‡åˆªé™¤

### 1.4 RoleBinding

**ç¶å®šåˆ° ServiceAccountï¼š**
```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: read-pods
  namespace: production
subjects:
- kind: ServiceAccount
  name: webapp-sa
  namespace: production
roleRef:
  kind: Role
  name: pod-reader
  apiGroup: rbac.authorization.k8s.io
```

**ç¶å®šåˆ°ç”¨æˆ¶/çµ„ï¼š**
```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: cluster-admin-binding
subjects:
- kind: User
  name: admin@example.com
  apiGroup: rbac.authorization.k8s.io

- kind: Group
  name: system:masters
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: ClusterRole
  name: cluster-admin
  apiGroup: rbac.authorization.k8s.io
```

### 1.5 å¯¦æˆ°ï¼šé–‹ç™¼è€…æ¬Šé™é…ç½®

```yaml
apiVersion: v1
kind: Namespace
metadata:
  name: dev-team

---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: developer
  namespace: dev-team
rules:
- apiGroups: ["", "apps", "batch"]
  resources: ["pods", "deployments", "services", "jobs", "cronjobs"]
  verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]

- apiGroups: [""]
  resources: ["pods/log", "pods/exec"]
  verbs: ["get", "create"]

- apiGroups: [""]
  resources: ["configmaps", "secrets"]
  verbs: ["get", "list"]

---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: developer-binding
  namespace: dev-team
subjects:
- kind: Group
  name: developers
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: Role
  name: developer
  apiGroup: rbac.authorization.k8s.io
```

**æ¸¬è©¦æ¬Šé™ï¼š**
```bash
kubectl auth can-i get pods --namespace dev-team --as system:serviceaccount:dev-team:webapp-sa

kubectl auth can-i delete deployments --namespace dev-team --as-group=developers

kubectl auth can-i list secrets --namespace production --as alice@example.com
```

---

## 2. NetworkPolicy ç¶²çµ¡éš”é›¢

### 2.1 ç¶²çµ¡ç­–ç•¥æ¨¡å‹

```mermaid
graph TB
    subgraph "é»˜èªè¡Œç‚º"
        A[æ‰€æœ‰ Pod] -.äº’é€š.-> B[æ‰€æœ‰ Pod]
    end
    
    subgraph "æ‡‰ç”¨ NetworkPolicy å¾Œ"
        C[Frontend Pod] -->|å…è¨±| D[Backend Pod]
        E[External] -->|æ‹’çµ•| D
        D -->|å…è¨±| F[Database Pod]
        C -->|æ‹’çµ•| F
    end
    
    style A fill:#f96
    style C fill:#9f9
    style D fill:#9cf
```

### 2.2 åŸºç¤ NetworkPolicy

**æ‹’çµ•æ‰€æœ‰å…¥ç«™æµé‡ï¼š**
```yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: deny-all-ingress
  namespace: production
spec:
  podSelector: {}
  policyTypes:
  - Ingress
```

**å…è¨±ç‰¹å®šæµé‡ï¼š**
```yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-frontend-to-backend
  namespace: production
spec:
  podSelector:
    matchLabels:
      app: backend
  
  policyTypes:
  - Ingress
  - Egress
  
  ingress:
  - from:
    - podSelector:
        matchLabels:
          app: frontend
    ports:
    - protocol: TCP
      port: 8080
  
  egress:
  - to:
    - podSelector:
        matchLabels:
          app: database
    ports:
    - protocol: TCP
      port: 5432
  
  - to:
    - namespaceSelector:
        matchLabels:
          name: kube-system
    - podSelector:
        matchLabels:
          k8s-app: kube-dns
    ports:
    - protocol: UDP
      port: 53
```

### 2.3 è·¨ Namespace ç­–ç•¥

```yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-from-monitoring
  namespace: production
spec:
  podSelector:
    matchLabels:
      app: webapp
  
  policyTypes:
  - Ingress
  
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          name: monitoring
      podSelector:
        matchLabels:
          app: prometheus
    ports:
    - protocol: TCP
      port: 9090
```

### 2.4 å¤–éƒ¨è¨ªå•ç­–ç•¥

```yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-external-ingress
  namespace: production
spec:
  podSelector:
    matchLabels:
      app: api-gateway
  
  policyTypes:
  - Ingress
  
  ingress:
  - from:
    - ipBlock:
        cidr: 0.0.0.0/0
        except:
        - 10.0.0.0/8
        - 172.16.0.0/12
        - 192.168.0.0/16
    ports:
    - protocol: TCP
      port: 443
```

### 2.5 å®Œæ•´å¾®æœå‹™ç¶²çµ¡ç­–ç•¥

```yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: microservices-policy
  namespace: production
spec:
  podSelector:
    matchLabels:
      tier: backend
  
  policyTypes:
  - Ingress
  - Egress
  
  ingress:
  - from:
    - podSelector:
        matchLabels:
          tier: frontend
    - podSelector:
        matchLabels:
          tier: backend
    ports:
    - protocol: TCP
      port: 8080
  
  egress:
  - to:
    - podSelector:
        matchLabels:
          tier: database
    ports:
    - protocol: TCP
      port: 5432
  
  - to:
    - podSelector:
        matchLabels:
          app: redis
    ports:
    - protocol: TCP
      port: 6379
  
  - to:
    - namespaceSelector: {}
      podSelector:
        matchLabels:
          k8s-app: kube-dns
    ports:
    - protocol: UDP
      port: 53
  
  - to:
    - ipBlock:
        cidr: 0.0.0.0/0
    ports:
    - protocol: TCP
      port: 443
```

---

## 3. Pod Security Standards

### 3.1 ä¸‰ç¨®å®‰å…¨ç´šåˆ¥

```mermaid
graph LR
    A[Privileged<br/>ç‰¹æ¬Šæ¨¡å¼] --> B[Baseline<br/>åŸºç·šæ¨¡å¼]
    B --> C[Restricted<br/>é™åˆ¶æ¨¡å¼]
    
    A -.æœ€å¯¬é¬†.-> D[å…è¨±æ‰€æœ‰æ“ä½œ]
    C -.æœ€åš´æ ¼.-> E[ç”Ÿç”¢ç’°å¢ƒæ¨è–¦]
    
    style A fill:#f96
    style B fill:#fc9
    style C fill:#9f9
```

| ç´šåˆ¥ | èªªæ˜ | é©ç”¨å ´æ™¯ |
|-----|------|---------|
| **Privileged** | ç„¡é™åˆ¶ï¼Œå…è¨±æ‰€æœ‰æ“ä½œ | ç³»çµ±çµ„ä»¶ï¼ˆCNIã€CSIï¼‰ |
| **Baseline** | æœ€å°é™åˆ¶ï¼Œé˜²æ­¢å·²çŸ¥ææ¬Š | é–‹ç™¼ç’°å¢ƒ |
| **Restricted** | åš´æ ¼é™åˆ¶ï¼Œéµå¾ªæœ€ä½³å¯¦è¸ | ç”Ÿç”¢ç’°å¢ƒ |

### 3.2 Namespace ç´šåˆ¥ç­–ç•¥

**å•Ÿç”¨ Pod Security Admissionï¼š**
```yaml
apiVersion: v1
kind: Namespace
metadata:
  name: production
  labels:
    pod-security.kubernetes.io/enforce: restricted
    pod-security.kubernetes.io/audit: restricted
    pod-security.kubernetes.io/warn: restricted
```

### 3.3 Restricted æ¨¡å¼ Pod é…ç½®

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: secure-pod
spec:
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000
    seccompProfile:
      type: RuntimeDefault
  
  containers:
  - name: app
    image: myapp:v1.0
    
    securityContext:
      allowPrivilegeEscalation: false
      runAsNonRoot: true
      runAsUser: 1000
      
      capabilities:
        drop:
        - ALL
      
      readOnlyRootFilesystem: true
      
      seccompProfile:
        type: RuntimeDefault
    
    volumeMounts:
    - name: tmp
      mountPath: /tmp
    - name: cache
      mountPath: /app/cache
  
  volumes:
  - name: tmp
    emptyDir: {}
  - name: cache
    emptyDir: {}
```

### 3.4 SecurityContext æœ€ä½³å¯¦è¸

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: webapp-secure
spec:
  template:
    spec:
      securityContext:
        runAsNonRoot: true
        runAsUser: 10001
        fsGroup: 10001
        supplementalGroups: [10001]
        seccompProfile:
          type: RuntimeDefault
      
      containers:
      - name: app
        image: myapp:v1.0
        
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
          runAsUser: 10001
          
          capabilities:
            drop:
            - ALL
            add:
            - NET_BIND_SERVICE
        
        volumeMounts:
        - name: tmp
          mountPath: /tmp
        - name: app-data
          mountPath: /app/data
      
      volumes:
      - name: tmp
        emptyDir:
          sizeLimit: 100Mi
      - name: app-data
        persistentVolumeClaim:
          claimName: app-data-pvc
```

---

## 4. å¯†é‘°ç®¡ç†

### 4.1 Sealed Secrets

```mermaid
graph LR
    A[åŸå§‹ Secret] -->|kubeseal åŠ å¯†| B[Sealed Secret]
    B -->|æäº¤åˆ° Git| C[Git Repo]
    C -->|ArgoCD éƒ¨ç½²| D[Kubernetes]
    D -->|Controller è§£å¯†| E[Secret]
    
    style B fill:#9f9
    style E fill:#9cf
```

**å®‰è£ Sealed Secretsï¼š**
```bash
kubectl apply -f https://github.com/bitnami-labs/sealed-secrets/releases/download/v0.24.0/controller.yaml

kubeseal --fetch-cert > pub-cert.pem
```

**å‰µå»º Sealed Secretï¼š**
```bash
kubectl create secret generic db-credentials \
  --from-literal=username=admin \
  --from-literal=password='MyS3cretP@ss' \
  --dry-run=client -o yaml | \
  kubeseal --cert pub-cert.pem --format yaml > sealed-secret.yaml

kubectl apply -f sealed-secret.yaml
```

**SealedSecret YAMLï¼š**
```yaml
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  name: db-credentials
  namespace: production
spec:
  encryptedData:
    username: AgBqL3...encrypted...
    password: AgCY9...encrypted...
  template:
    metadata:
      name: db-credentials
      namespace: production
    type: Opaque
```

### 4.2 External Secrets Operator

**å®‰è£ï¼š**
```bash
helm repo add external-secrets https://charts.external-secrets.io
helm install external-secrets external-secrets/external-secrets -n external-secrets --create-namespace
```

**é…ç½® AWS Secrets Managerï¼š**
```yaml
apiVersion: external-secrets.io/v1beta1
kind: SecretStore
metadata:
  name: aws-secrets
  namespace: production
spec:
  provider:
    aws:
      service: SecretsManager
      region: us-east-1
      auth:
        jwt:
          serviceAccountRef:
            name: external-secrets-sa

---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: db-credentials
  namespace: production
spec:
  refreshInterval: 1h
  
  secretStoreRef:
    name: aws-secrets
    kind: SecretStore
  
  target:
    name: db-credentials
    creationPolicy: Owner
  
  data:
  - secretKey: username
    remoteRef:
      key: prod/database
      property: username
  
  - secretKey: password
    remoteRef:
      key: prod/database
      property: password
```

### 4.3 HashiCorp Vault

**å®‰è£ Vaultï¼š**
```bash
helm repo add hashicorp https://helm.releases.hashicorp.com
helm install vault hashicorp/vault --namespace vault --create-namespace
```

**é…ç½® Vault Agent Injectorï¼š**
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: webapp
spec:
  template:
    metadata:
      annotations:
        vault.hashicorp.com/agent-inject: "true"
        vault.hashicorp.com/role: "webapp"
        vault.hashicorp.com/agent-inject-secret-database: "secret/data/database"
        vault.hashicorp.com/agent-inject-template-database: |
          {{- with secret "secret/data/database" -}}
          export DB_USER="{{ .Data.data.username }}"
          export DB_PASSWORD="{{ .Data.data.password }}"
          {{- end }}
    spec:
      serviceAccountName: webapp-sa
      containers:
      - name: app
        image: myapp:v1.0
```

---

## 5. é¡åƒå®‰å…¨

### 5.1 ä½¿ç”¨ Trivy æƒæ

```bash
trivy image myregistry/webapp:v1.0

trivy image --severity HIGH,CRITICAL myregistry/webapp:v1.0

trivy image --format json --output trivy-report.json myregistry/webapp:v1.0
```

**é›†æˆåˆ° CI/CDï¼š**
```yaml
name: Container Security Scan

on: [push]

jobs:
  security-scan:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Build image
      run: docker build -t myapp:${{ github.sha }} .
    
    - name: Run Trivy scan
      uses: aquasecurity/trivy-action@master
      with:
        image-ref: 'myapp:${{ github.sha }}'
        format: 'sarif'
        output: 'trivy-results.sarif'
        severity: 'CRITICAL,HIGH'
        exit-code: '1'
    
    - name: Upload results
      uses: github/codeql-action/upload-sarif@v2
      with:
        sarif_file: 'trivy-results.sarif'
```

### 5.2 é¡åƒç°½åèˆ‡é©—è­‰

**ä½¿ç”¨ Cosign ç°½åï¼š**
```bash
cosign generate-key-pair

cosign sign --key cosign.key myregistry/webapp:v1.0

cosign verify --key cosign.pub myregistry/webapp:v1.0
```

**Admission Controller é©—è­‰ï¼š**
```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: image-verification-policy
  namespace: cosign-system
data:
  policy.yaml: |
    apiVersion: policy.sigstore.dev/v1beta1
    kind: ClusterImagePolicy
    metadata:
      name: require-signature
    spec:
      images:
      - glob: "myregistry/**"
      authorities:
      - key:
          data: |
            -----BEGIN PUBLIC KEY-----
            MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAE...
            -----END PUBLIC KEY-----
```

### 5.3 ç§æœ‰ Registry

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: regcred
  namespace: production
type: kubernetes.io/dockerconfigjson
data:
  .dockerconfigjson: <base64-encoded-config>

---
apiVersion: v1
kind: Pod
metadata:
  name: webapp
spec:
  imagePullSecrets:
  - name: regcred
  
  containers:
  - name: app
    image: myregistry.example.com/webapp:v1.0
```

---

## 6. å¯©è¨ˆèˆ‡åˆè¦

### 6.1 å¯©è¨ˆæ—¥èªŒ

**å•Ÿç”¨å¯©è¨ˆï¼š**
```yaml
apiVersion: audit.k8s.io/v1
kind: Policy
rules:
- level: Metadata
  omitStages:
  - RequestReceived
  
  resources:
  - group: ""
    resources: ["secrets", "configmaps"]

- level: Request
  verbs: ["create", "update", "patch", "delete"]
  
  resources:
  - group: "apps"
    resources: ["deployments", "statefulsets"]

- level: RequestResponse
  verbs: ["delete"]
  
  resources:
  - group: ""
    resources: ["pods"]
  
  namespaces: ["production"]
```

### 6.2 Falco é‹è¡Œæ™‚å®‰å…¨

**å®‰è£ Falcoï¼š**
```bash
helm repo add falcosecurity https://falcosecurity.github.io/charts
helm install falco falcosecurity/falco --namespace falco --create-namespace
```

**è‡ªå®šç¾©è¦å‰‡ï¼š**
```yaml
- rule: Unauthorized Process in Container
  desc: Detect unexpected process execution
  condition: >
    spawned_process and
    container and
    not proc.name in (nginx, node, python, java)
  output: >
    Unexpected process started (user=%user.name command=%proc.cmdline container=%container.name)
  priority: WARNING

- rule: Write to Sensitive File
  desc: Detect writes to sensitive directories
  condition: >
    open_write and
    container and
    fd.name startswith /etc
  output: >
    Write to sensitive file (user=%user.name file=%fd.name container=%container.name)
  priority: ERROR
```

### 6.3 OPA Gatekeeper

**å®‰è£ï¼š**
```bash
kubectl apply -f https://raw.githubusercontent.com/open-policy-agent/gatekeeper/master/deploy/gatekeeper.yaml
```

**å¼·åˆ¶è¦æ±‚è³‡æºé™åˆ¶ï¼š**
```yaml
apiVersion: templates.gatekeeper.sh/v1
kind: ConstraintTemplate
metadata:
  name: k8srequiredresources
spec:
  crd:
    spec:
      names:
        kind: K8sRequiredResources
  targets:
  - target: admission.k8s.gatekeeper.sh
    rego: |
      package k8srequiredresources
      
      violation[{"msg": msg}] {
        container := input.review.object.spec.containers[_]
        not container.resources.limits.cpu
        msg := sprintf("Container %v must have CPU limit", [container.name])
      }
      
      violation[{"msg": msg}] {
        container := input.review.object.spec.containers[_]
        not container.resources.limits.memory
        msg := sprintf("Container %v must have memory limit", [container.name])
      }

---
apiVersion: constraints.gatekeeper.sh/v1beta1
kind: K8sRequiredResources
metadata:
  name: must-have-resources
spec:
  match:
    kinds:
    - apiGroups: ["apps"]
      kinds: ["Deployment"]
    namespaces: ["production"]
```

**ç¦æ­¢ç‰¹æ¬Šå®¹å™¨ï¼š**
```yaml
apiVersion: constraints.gatekeeper.sh/v1beta1
kind: K8sPSPPrivilegedContainer
metadata:
  name: deny-privileged-containers
spec:
  match:
    kinds:
    - apiGroups: [""]
      kinds: ["Pod"]
    excludedNamespaces: ["kube-system"]
```

---

## 7. å®‰å…¨æª¢æŸ¥æ¸…å–®

### 7.1 é›†ç¾¤å®‰å…¨

- â˜ å•Ÿç”¨ RBAC ä¸¦éµå¾ªæœ€å°æ¬Šé™åŸå‰‡
- â˜ ç¦ç”¨åŒ¿åè¨ªå•
- â˜ å•Ÿç”¨å¯©è¨ˆæ—¥èªŒ
- â˜ å®šæœŸæ›´æ–° Kubernetes ç‰ˆæœ¬
- â˜ åŠ å¯† etcd æ•¸æ“š
- â˜ ä½¿ç”¨ NetworkPolicy éš”é›¢ç¶²çµ¡
- â˜ é™åˆ¶ API Server è¨ªå•ï¼ˆIP ç™½åå–®ï¼‰

### 7.2 å·¥ä½œè² è¼‰å®‰å…¨

- â˜ ä½¿ç”¨é root ç”¨æˆ¶é‹è¡Œå®¹å™¨
- â˜ è¨­ç½® readOnlyRootFilesystem
- â˜ ç¦ç”¨ allowPrivilegeEscalation
- â˜ Drop æ‰€æœ‰ capabilities
- â˜ è¨­ç½®è³‡æºé™åˆ¶
- â˜ é…ç½®å¥åº·æª¢æŸ¥
- â˜ ä½¿ç”¨ Pod Security Standards (Restricted)

### 7.3 å¯†é‘°ç®¡ç†

- â˜ ä¸åœ¨ä»£ç¢¼ä¸­ç¡¬ç·¨ç¢¼å¯†é‘°
- â˜ ä½¿ç”¨ Sealed Secrets æˆ– Vault
- â˜ å®šæœŸè¼ªæ›å¯†é‘°
- â˜ é™åˆ¶ Secret è¨ªå•æ¬Šé™
- â˜ å•Ÿç”¨ etcd åŠ å¯†
- â˜ å¯©è¨ˆ Secret è¨ªå•

### 7.4 é¡åƒå®‰å…¨

- â˜ ä½¿ç”¨å®˜æ–¹åŸºç¤é¡åƒ
- â˜ å®šæœŸæƒææ¼æ´ï¼ˆTrivyï¼‰
- â˜ ä½¿ç”¨æœ€å°åŒ–é¡åƒï¼ˆalpine/distrolessï¼‰
- â˜ ç°½åä¸¦é©—è­‰é¡åƒ
- â˜ ä½¿ç”¨ç§æœ‰ Registry
- â˜ å¯¦æ–½é¡åƒæ‹‰å–ç­–ç•¥

---

## 8. å°çµ

æœ¬ç« ä»‹ç´¹äº† Kubernetes å®‰å…¨æ€§çš„å®Œæ•´å¯¦è¸ï¼š

**RBAC æ¬Šé™æ§åˆ¶ï¼š**
- âœ… ServiceAccount + Role + RoleBinding
- âœ… æœ€å°æ¬Šé™åŸå‰‡
- âœ… å‘½åç©ºé–“ç´šåˆ¥éš”é›¢
- âœ… å¯©è¨ˆèˆ‡é©—è­‰

**ç¶²çµ¡éš”é›¢ï¼š**
- âœ… NetworkPolicy å…¥ç«™/å‡ºç«™è¦å‰‡
- âœ… å¾®æœå‹™ç¶²çµ¡ç­–ç•¥
- âœ… è·¨ Namespace è¨ªå•æ§åˆ¶
- âœ… å¤–éƒ¨è¨ªå•é™åˆ¶

**Pod å®‰å…¨ï¼š**
- âœ… Pod Security Standards (Restricted)
- âœ… SecurityContext é…ç½®
- âœ… é root ç”¨æˆ¶
- âœ… åªè®€æ–‡ä»¶ç³»çµ±

**å¯†é‘°ç®¡ç†ï¼š**
- âœ… Sealed Secretsï¼ˆGitOps å‹å¥½ï¼‰
- âœ… External Secrets Operator
- âœ… HashiCorp Vault
- âœ… å¯†é‘°è¼ªæ›ç­–ç•¥

**é¡åƒå®‰å…¨ï¼š**
- âœ… Trivy æ¼æ´æƒæ
- âœ… Cosign ç°½åé©—è­‰
- âœ… ç§æœ‰ Registry
- âœ… CI/CD å®‰å…¨æª¢æŸ¥

**å¯©è¨ˆèˆ‡åˆè¦ï¼š**
- âœ… Kubernetes å¯©è¨ˆæ—¥èªŒ
- âœ… Falco é‹è¡Œæ™‚ç›£æ§
- âœ… OPA Gatekeeper ç­–ç•¥å¼•æ“
- âœ… åˆè¦æ€§æª¢æŸ¥

ä¸‹ä¸€ç« å°‡å­¸ç¿’æ•ˆèƒ½å„ªåŒ–ï¼ŒåŒ…æ‹¬è³‡æºèª¿å„ªã€èª¿åº¦ç­–ç•¥å’Œç¶²çµ¡æ€§èƒ½æå‡ã€‚
