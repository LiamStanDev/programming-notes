# 01-æ‡‰ç”¨å®¹å™¨åŒ–èˆ‡é·ç§»ç­–ç•¥

> å°‡æ—¢æœ‰æ‡‰ç”¨é·ç§»åˆ° Kubernetes çš„å®Œæ•´æŒ‡å—

---

## ğŸ“š æœ¬ç« ç›®æ¨™

- æŒæ¡æ‡‰ç”¨å®¹å™¨åŒ–çš„æœ€ä½³å¯¦è¸
- äº†è§£ä¸åŒé¡å‹æ‡‰ç”¨çš„é·ç§»ç­–ç•¥
- è™•ç†ç‹€æ…‹ç®¡ç†èˆ‡æ•¸æ“šé·ç§»
- é¿å…å¸¸è¦‹çš„é·ç§»é™·é˜±

---

## 1. å®¹å™¨åŒ–åŸºç¤

### 1.1 ä»€éº¼é©åˆå®¹å™¨åŒ–ï¼Ÿ

```mermaid
graph TB
    subgraph "é©åˆå®¹å™¨åŒ–"
        A[ç„¡ç‹€æ…‹ Web æœå‹™]
        B[API å¾Œç«¯]
        C[æ‰¹æ¬¡è™•ç†ä»»å‹™]
        D[å¾®æœå‹™]
    end
    
    subgraph "éœ€è¬¹æ…è™•ç†"
        E[æœ‰ç‹€æ…‹æ•¸æ“šåº«]
        F[æ–‡ä»¶ç³»çµ±ä¾è³´]
        G[ç¡¬ä»¶ä¾è³´]
        H[å–®é«”å·¨çŸ³æ‡‰ç”¨]
    end
    
    style A fill:#9f9
    style B fill:#9f9
    style C fill:#9f9
    style D fill:#9f9
    
    style E fill:#fc9
    style F fill:#fc9
    style G fill:#fc9
    style H fill:#fc9
```

**æ±ºç­–çŸ©é™£ï¼š**

| æ‡‰ç”¨é¡å‹        | å®¹å™¨åŒ–é›£åº¦  | å»ºè­°ç­–ç•¥                |
| ----------- | ------ | ------------------- |
| ç„¡ç‹€æ…‹ Web æ‡‰ç”¨  | â­ ç°¡å–®   | ç›´æ¥å®¹å™¨åŒ–               |
| RESTful API | â­ ç°¡å–®   | ç›´æ¥å®¹å™¨åŒ–               |
| å‰ç«¯éœæ…‹è³‡æº      | â­ ç°¡å–®   | Nginx + CDN         |
| æœ‰ç‹€æ…‹æ•¸æ“šåº«      | â­â­â­ è¤‡é›œ | ä½¿ç”¨è¨—ç®¡æœå‹™æˆ– StatefulSet |
| æ¶ˆæ¯éšŠåˆ—        | â­â­ ä¸­ç­‰  | StatefulSet + PV    |
| å®šæ™‚ä»»å‹™        | â­ ç°¡å–®   | CronJob             |
| å–®é«”æ‡‰ç”¨        | â­â­â­ è¤‡é›œ | åˆ†éšæ®µæ‹†åˆ†æˆ–æ•´é«”å®¹å™¨åŒ–         |

---

## 2. Dockerfile æœ€ä½³å¯¦è¸

### 2.1 å¤šéšæ®µæ§‹å»º

**å‚³çµ±æ–¹å¼ï¼ˆé¡åƒéå¤§ï¼‰ï¼š**
```dockerfile
FROM node:20
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build
EXPOSE 3000
CMD ["npm", "start"]
```

**å¤šéšæ®µæ§‹å»ºï¼ˆå„ªåŒ–ï¼‰ï¼š**
```dockerfile
FROM node:20 AS builder
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production && \
    npm cache clean --force
COPY . .
RUN npm run build

FROM node:20-alpine
WORKDIR /app

RUN addgroup -g 1001 -S nodejs && \
    adduser -S nodejs -u 1001

COPY --from=builder --chown=nodejs:nodejs /app/dist ./dist
COPY --from=builder --chown=nodejs:nodejs /app/node_modules ./node_modules
COPY --chown=nodejs:nodejs package*.json ./

USER nodejs

EXPOSE 3000

HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
  CMD node healthcheck.js

CMD ["node", "dist/main.js"]
```

**æ”¹é€²é»ï¼š**
- âœ… ä½¿ç”¨ alpine åŸºç¤é¡åƒï¼ˆé«”ç©æ›´å°ï¼‰
- âœ… å¤šéšæ®µæ§‹å»ºï¼ˆåƒ…ä¿ç•™é‹è¡Œæ™‚éœ€è¦çš„æ–‡ä»¶ï¼‰
- âœ… é root ç”¨æˆ¶é‹è¡Œï¼ˆå®‰å…¨æ€§ï¼‰
- âœ… å¥åº·æª¢æŸ¥ï¼ˆå¯é æ€§ï¼‰
- âœ… å„ªåŒ–å±¤ç·©å­˜ï¼ˆæ§‹å»ºé€Ÿåº¦ï¼‰

### 2.2 èªè¨€ç‰¹å®šæœ€ä½³å¯¦è¸

**Python æ‡‰ç”¨ï¼š**
```dockerfile
FROM python:3.12-slim AS builder

RUN apt-get update && \
    apt-get install -y --no-install-recommends gcc && \
    rm -rf /var/lib/apt/lists/*

WORKDIR /app

COPY requirements.txt .
RUN pip install --user --no-cache-dir -r requirements.txt

FROM python:3.12-slim

RUN groupadd -r appuser && useradd -r -g appuser appuser

WORKDIR /app

COPY --from=builder /root/.local /home/appuser/.local
COPY --chown=appuser:appuser . .

ENV PATH=/home/appuser/.local/bin:$PATH

USER appuser

EXPOSE 8000

HEALTHCHECK --interval=30s --timeout=3s --start-period=40s \
  CMD python -c "import requests; requests.get('http://localhost:8000/health', timeout=2)"

CMD ["gunicorn", "--bind", "0.0.0.0:8000", "--workers", "4", "app:app"]
```

**Go æ‡‰ç”¨ï¼š**
```dockerfile
FROM golang:1.22 AS builder

WORKDIR /app

COPY go.mod go.sum ./
RUN go mod download

COPY . .

RUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo \
    -ldflags '-extldflags "-static" -s -w' \
    -o main .

FROM scratch

COPY --from=builder /etc/ssl/certs/ca-certificates.crt /etc/ssl/certs/
COPY --from=builder /app/main /main

EXPOSE 8080

USER 65534:65534

ENTRYPOINT ["/main"]
```

**Rust æ‡‰ç”¨ï¼š**
```dockerfile
FROM rust:1.75 AS builder

WORKDIR /app

COPY Cargo.toml Cargo.lock ./
RUN mkdir src && \
    echo "fn main() {}" > src/main.rs && \
    cargo build --release && \
    rm -rf src

COPY src ./src
RUN touch src/main.rs && cargo build --release

FROM debian:bookworm-slim

RUN apt-get update && \
    apt-get install -y --no-install-recommends ca-certificates && \
    rm -rf /var/lib/apt/lists/*

COPY --from=builder /app/target/release/myapp /usr/local/bin/myapp

RUN useradd -m -u 1000 appuser
USER appuser

EXPOSE 8080

CMD ["myapp"]
```

### 2.3 é¡åƒå„ªåŒ–æŠ€å·§

```mermaid
graph LR
    A[åŸå§‹é¡åƒ<br/>500MB] --> B[ä½¿ç”¨ alpine<br/>200MB]
    B --> C[å¤šéšæ®µæ§‹å»º<br/>100MB]
    C --> D[ç§»é™¤ä¸å¿…è¦æ–‡ä»¶<br/>50MB]
    D --> E[å£“ç¸®éœæ…‹è³‡æº<br/>30MB]
    
    style A fill:#f96
    style E fill:#9f9
```

**å„ªåŒ–æ¸…å–®ï¼š**
- âœ… ä½¿ç”¨å®˜æ–¹åŸºç¤é¡åƒçš„ slim æˆ– alpine ç‰ˆæœ¬
- âœ… åˆä½µ RUN æŒ‡ä»¤æ¸›å°‘å±¤æ•¸
- âœ… åˆ©ç”¨æ§‹å»ºç·©å­˜ï¼Œå…ˆè¤‡è£½ä¾è³´æ–‡ä»¶
- âœ… ä½¿ç”¨ `.dockerignore` æ’é™¤ä¸å¿…è¦æ–‡ä»¶
- âœ… å¤šéšæ®µæ§‹å»ºåƒ…ä¿ç•™é‹è¡Œæ™‚æ–‡ä»¶
- âœ… æ¸…ç†åŒ…ç®¡ç†å™¨ç·©å­˜

**.dockerignore ç¤ºä¾‹ï¼š**
```
.git
.gitignore
.env
.env.local
node_modules
npm-debug.log
README.md
.dockerignore
Dockerfile
.vscode
.idea
*.md
tests/
docs/
*.test.js
coverage/
```

---

## 3. æ‡‰ç”¨é·ç§»ç­–ç•¥

### 3.1 é·ç§»è·¯å¾‘é¸æ“‡

```mermaid
graph TB
    Start[æ—¢æœ‰æ‡‰ç”¨] --> Decision{æ‡‰ç”¨æ¶æ§‹?}
    
    Decision -->|ç„¡ç‹€æ…‹ Web| Simple[ç°¡å–®é·ç§»]
    Decision -->|æœ‰ç‹€æ…‹æœå‹™| Complex[è¤‡é›œé·ç§»]
    Decision -->|å–®é«”æ‡‰ç”¨| Monolith[åˆ†éšæ®µé·ç§»]
    
    Simple --> S1[å®¹å™¨åŒ–æ‡‰ç”¨]
    S1 --> S2[é…ç½®å¤–éƒ¨åŒ–]
    S2 --> S3[éƒ¨ç½²åˆ° K8s]
    
    Complex --> C1[åˆ†é›¢ç‹€æ…‹èˆ‡é‚è¼¯]
    C1 --> C2[ä½¿ç”¨ StatefulSet/PV]
    C2 --> C3[æ•¸æ“šé·ç§»]
    C3 --> C4[ç°åº¦ç™¼å¸ƒ]
    
    Monolith --> M1[è­˜åˆ¥é‚Šç•Œ]
    M1 --> M2[API Gateway å¼•å…¥]
    M2 --> M3[é€æ­¥æ‹†åˆ†æœå‹™]
    M3 --> M4[å¾®æœå‹™åŒ–]
    
    style Simple fill:#9f9
    style Complex fill:#fc9
    style Monolith fill:#f96
```

### 3.2 ç„¡ç‹€æ…‹æ‡‰ç”¨é·ç§»

**æ­¥é©Ÿ 1ï¼šå®¹å™¨åŒ–**

```dockerfile
FROM node:20-alpine

WORKDIR /app

COPY package*.json ./
RUN npm ci --only=production

COPY . .

ENV NODE_ENV=production \
    PORT=3000

USER node

EXPOSE 3000

CMD ["node", "server.js"]
```

**æ­¥é©Ÿ 2ï¼šé…ç½®å¤–éƒ¨åŒ–**

åŸå§‹ä»£ç¢¼ï¼š
```javascript
const config = {
  database: {
    host: 'localhost',
    port: 5432,
    username: 'admin',
    password: 'hardcoded'
  }
};
```

æ”¹é€²å¾Œï¼š
```javascript
const config = {
  database: {
    host: process.env.DB_HOST || 'localhost',
    port: parseInt(process.env.DB_PORT || '5432'),
    username: process.env.DB_USER,
    password: process.env.DB_PASSWORD
  }
};
```

**æ­¥é©Ÿ 3ï¼šK8s é…ç½®**

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: webapp
spec:
  replicas: 3
  selector:
    matchLabels:
      app: webapp
  template:
    metadata:
      labels:
        app: webapp
    spec:
      containers:
      - name: webapp
        image: myregistry/webapp:v1.0
        ports:
        - containerPort: 3000
        
        env:
        - name: DB_HOST
          value: "postgres.database.svc.cluster.local"
        - name: DB_PORT
          value: "5432"
        - name: DB_USER
          valueFrom:
            secretKeyRef:
              name: db-credentials
              key: username
        - name: DB_PASSWORD
          valueFrom:
            secretKeyRef:
              name: db-credentials
              key: password
        
        resources:
          requests:
            cpu: 100m
            memory: 128Mi
          limits:
            cpu: 500m
            memory: 512Mi
        
        livenessProbe:
          httpGet:
            path: /health
            port: 3000
          initialDelaySeconds: 30
          periodSeconds: 10
        
        readinessProbe:
          httpGet:
            path: /ready
            port: 3000
          initialDelaySeconds: 5
          periodSeconds: 5
---
apiVersion: v1
kind: Service
metadata:
  name: webapp
spec:
  selector:
    app: webapp
  ports:
  - port: 80
    targetPort: 3000
  type: ClusterIP
```

### 3.3 æœ‰ç‹€æ…‹æ‡‰ç”¨é·ç§»

**æ•¸æ“šåº«é·ç§»ç­–ç•¥ï¼š**

```mermaid
graph TB
    subgraph "å¤–éƒ¨è¨—ç®¡ï¼ˆæ¨è–¦ï¼‰"
        A[AWS RDS]
        B[Google Cloud SQL]
        C[Azure Database]
    end
    
    subgraph "K8s å…§éƒ¨é‹è¡Œ"
        D[StatefulSet]
        E[Operator éƒ¨ç½²]
        F[Helm Chart]
    end
    
    App[æ‡‰ç”¨ Pod] --> Choice{é¸æ“‡ç­–ç•¥}
    
    Choice -->|ç”Ÿç”¢ç’°å¢ƒ| A
    Choice -->|é–‹ç™¼/æ¸¬è©¦| D
    Choice -->|è‡ªå‹•åŒ–ç®¡ç†| E
    
    style A fill:#9f9
    style D fill:#fc9
    style E fill:#9cf
```

**PostgreSQL StatefulSet ç¤ºä¾‹ï¼š**

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: postgres-config
data:
  POSTGRES_DB: mydb
  POSTGRES_USER: admin

---
apiVersion: v1
kind: Secret
metadata:
  name: postgres-secret
type: Opaque
stringData:
  POSTGRES_PASSWORD: "YourSecurePassword"

---
apiVersion: v1
kind: Service
metadata:
  name: postgres
spec:
  clusterIP: None
  selector:
    app: postgres
  ports:
  - port: 5432
    targetPort: 5432

---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: postgres
spec:
  serviceName: postgres
  replicas: 1
  selector:
    matchLabels:
      app: postgres
  
  template:
    metadata:
      labels:
        app: postgres
    spec:
      containers:
      - name: postgres
        image: postgres:16
        
        ports:
        - containerPort: 5432
          name: postgres
        
        envFrom:
        - configMapRef:
            name: postgres-config
        - secretRef:
            name: postgres-secret
        
        volumeMounts:
        - name: postgres-storage
          mountPath: /var/lib/postgresql/data
          subPath: postgres
        
        resources:
          requests:
            cpu: 500m
            memory: 1Gi
          limits:
            cpu: 1000m
            memory: 2Gi
        
        livenessProbe:
          exec:
            command:
            - pg_isready
            - -U
            - admin
          initialDelaySeconds: 30
          periodSeconds: 10
        
        readinessProbe:
          exec:
            command:
            - pg_isready
            - -U
            - admin
          initialDelaySeconds: 5
          periodSeconds: 5
  
  volumeClaimTemplates:
  - metadata:
      name: postgres-storage
    spec:
      accessModes: ["ReadWriteOnce"]
      storageClassName: "fast-ssd"
      resources:
        requests:
          storage: 20Gi
```

**æ•¸æ“šé·ç§»æ­¥é©Ÿï¼š**

```mermaid
sequenceDiagram
    participant Old as èˆŠæ•¸æ“šåº«
    participant Backup as å‚™ä»½å·¥å…·
    participant Storage as å°è±¡å­˜å„²
    participant Job as K8s Job
    participant New as æ–°æ•¸æ“šåº«
    
    Old->>Backup: 1. å°å‡ºæ•¸æ“š
    Backup->>Storage: 2. ä¸Šå‚³å‚™ä»½
    Job->>Storage: 3. ä¸‹è¼‰å‚™ä»½
    Job->>New: 4. å°å…¥æ•¸æ“š
    Job->>Job: 5. é©—è­‰æ•¸æ“š
    Job->>New: 6. åˆ‡æ›æµé‡
```

**æ•¸æ“šå°å…¥ Jobï¼š**

```yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: db-migration
spec:
  template:
    spec:
      restartPolicy: OnFailure
      
      initContainers:
      - name: download-backup
        image: amazon/aws-cli
        command:
        - sh
        - -c
        - |
          aws s3 cp s3://my-backups/database-backup.sql /data/backup.sql
        
        volumeMounts:
        - name: backup-data
          mountPath: /data
        
        env:
        - name: AWS_ACCESS_KEY_ID
          valueFrom:
            secretKeyRef:
              name: aws-credentials
              key: access-key-id
        - name: AWS_SECRET_ACCESS_KEY
          valueFrom:
            secretKeyRef:
              name: aws-credentials
              key: secret-access-key
      
      containers:
      - name: import-data
        image: postgres:16
        command:
        - sh
        - -c
        - |
          echo "Importing database..."
          psql -h $DB_HOST -U $DB_USER -d $DB_NAME -f /data/backup.sql
          echo "Verifying data..."
          psql -h $DB_HOST -U $DB_USER -d $DB_NAME -c "SELECT COUNT(*) FROM users;"
        
        env:
        - name: DB_HOST
          value: "postgres.default.svc.cluster.local"
        - name: DB_USER
          valueFrom:
            secretKeyRef:
              name: postgres-secret
              key: username
        - name: DB_NAME
          value: "mydb"
        - name: PGPASSWORD
          valueFrom:
            secretKeyRef:
              name: postgres-secret
              key: password
        
        volumeMounts:
        - name: backup-data
          mountPath: /data
      
      volumes:
      - name: backup-data
        emptyDir: {}
```

---

## 4. å­˜å„²é·ç§»

### 4.1 å­˜å„²é¡å‹é¸æ“‡

```mermaid
graph TB
    subgraph "K8s å­˜å„²é¸é …"
        A[emptyDir<br/>è‡¨æ™‚å­˜å„²]
        B[hostPath<br/>ç¯€é»æœ¬åœ°]
        C[PV/PVC<br/>æŒä¹…åŒ–å­˜å„²]
        D[ConfigMap/Secret<br/>é…ç½®æ–‡ä»¶]
    end
    
    subgraph "å¤–éƒ¨å­˜å„²"
        E[å°è±¡å­˜å„²<br/>S3/MinIO]
        F[NFS]
        G[é›²ç«¯å¡Šå­˜å„²<br/>EBS/PD]
        H[åˆ†ä½ˆå¼å­˜å„²<br/>Ceph/Longhorn]
    end
    
    Use1[æ‡‰ç”¨æ—¥èªŒ] --> A
    Use2[ç·©å­˜æ•¸æ“š] --> A
    Use3[æ•¸æ“šåº«æ–‡ä»¶] --> C
    Use4[ç”¨æˆ¶ä¸Šå‚³] --> E
    Use5[å…±äº«é…ç½®] --> F
    
    C --> G
    C --> H
    
    style A fill:#fc9
    style C fill:#9cf
    style E fill:#9f9
```

### 4.2 PersistentVolume é…ç½®

**StorageClass å®šç¾©ï¼š**
```yaml
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: fast-ssd
provisioner: kubernetes.io/aws-ebs
parameters:
  type: gp3
  iops: "3000"
  throughput: "125"
  encrypted: "true"
volumeBindingMode: WaitForFirstConsumer
allowVolumeExpansion: true
reclaimPolicy: Retain
```

**PVC ä½¿ç”¨ï¼š**
```yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: app-data
spec:
  accessModes:
  - ReadWriteOnce
  storageClassName: fast-ssd
  resources:
    requests:
      storage: 10Gi

---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: app
spec:
  template:
    spec:
      containers:
      - name: app
        image: myapp:v1.0
        volumeMounts:
        - name: data
          mountPath: /data
      
      volumes:
      - name: data
        persistentVolumeClaim:
          claimName: app-data
```

### 4.3 å°è±¡å­˜å„²é›†æˆ

**MinIO ä½œç‚º S3 å…¼å®¹å­˜å„²ï¼š**

```python
import os
from minio import Minio

client = Minio(
    os.getenv("MINIO_ENDPOINT", "minio:9000"),
    access_key=os.getenv("MINIO_ACCESS_KEY"),
    secret_key=os.getenv("MINIO_SECRET_KEY"),
    secure=False
)

def upload_file(bucket_name, object_name, file_path):
    client.fput_object(bucket_name, object_name, file_path)

def download_file(bucket_name, object_name, file_path):
    client.fget_object(bucket_name, object_name, file_path)
```

**K8s é…ç½®ï¼š**
```yaml
apiVersion: v1
kind: Secret
metadata:
  name: minio-credentials
stringData:
  access-key: "minio-admin"
  secret-key: "minio-secret-key"

---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: app
spec:
  template:
    spec:
      containers:
      - name: app
        image: myapp:v1.0
        env:
        - name: MINIO_ENDPOINT
          value: "minio.storage.svc.cluster.local:9000"
        - name: MINIO_ACCESS_KEY
          valueFrom:
            secretKeyRef:
              name: minio-credentials
              key: access-key
        - name: MINIO_SECRET_KEY
          valueFrom:
            secretKeyRef:
              name: minio-credentials
              key: secret-key
```

---

## 5. å¸¸è¦‹é·ç§»é™·é˜±

### 5.1 é…ç½®ç¡¬ç·¨ç¢¼

```mermaid
graph LR
    A[âŒ ç¡¬ç·¨ç¢¼] --> B[ç„¡æ³•è·¨ç’°å¢ƒéƒ¨ç½²]
    C[âœ… ç’°å¢ƒè®Šé‡] --> D[éˆæ´»é…ç½®]
    E[âœ… ConfigMap] --> D
    F[âœ… Secret] --> D
    
    style A fill:#f96
    style C fill:#9f9
    style E fill:#9f9
    style F fill:#9f9
```

**éŒ¯èª¤ç¤ºä¾‹ï¼š**
```python
DATABASE_URL = "postgresql://admin:password@db.example.com:5432/mydb"
```

**æ­£ç¢ºåšæ³•ï¼š**
```python
import os

DATABASE_URL = os.getenv(
    "DATABASE_URL",
    "postgresql://admin:password@localhost:5432/mydb"
)
```

### 5.2 æ–‡ä»¶ç³»çµ±ä¾è³´

**å•é¡Œï¼š** æ‡‰ç”¨å¯«å…¥æœ¬åœ°æ–‡ä»¶ï¼ŒPod é‡å•Ÿå¾Œä¸Ÿå¤±

**è§£æ±ºæ–¹æ¡ˆï¼š**
```yaml
spec:
  containers:
  - name: app
    volumeMounts:
    - name: temp-storage
      mountPath: /tmp
    - name: persistent-storage
      mountPath: /data
  
  volumes:
  - name: temp-storage
    emptyDir: {}
  - name: persistent-storage
    persistentVolumeClaim:
      claimName: app-data-pvc
```

### 5.3 å¥åº·æª¢æŸ¥ç¼ºå¤±

**å¸¸è¦‹å•é¡Œï¼š**
- æ‡‰ç”¨å•Ÿå‹•å¾Œç«‹å³æ¥æ”¶æµé‡ï¼ˆå°šæœªå°±ç·’ï¼‰
- æ‡‰ç”¨æ›èµ·ä½† Pod æœªé‡å•Ÿ

**è§£æ±ºæ–¹æ¡ˆï¼š**
```yaml
livenessProbe:
  httpGet:
    path: /health
    port: 8080
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /ready
    port: 8080
  initialDelaySeconds: 5
  periodSeconds: 5
  timeoutSeconds: 3
  successThreshold: 1
  failureThreshold: 3
```

---

## 6. é·ç§»æª¢æŸ¥æ¸…å–®

**é·ç§»å‰ï¼š**
- â˜ æ‡‰ç”¨æ˜¯å¦æ”¯æŒå®¹å™¨åŒ–ï¼Ÿ
- â˜ è­˜åˆ¥æ‰€æœ‰å¤–éƒ¨ä¾è³´ï¼ˆæ•¸æ“šåº«ã€ç·©å­˜ã€æ¶ˆæ¯éšŠåˆ—ï¼‰
- â˜ æª¢æŸ¥ç¡¬ç·¨ç¢¼é…ç½®
- â˜ è©•ä¼°å­˜å„²éœ€æ±‚
- â˜ è¦åŠƒç¶²çµ¡æ‹“æ’²

**å®¹å™¨åŒ–ï¼š**
- â˜ ç·¨å¯« Dockerfile
- â˜ å¤šéšæ®µæ§‹å»ºå„ªåŒ–é¡åƒå¤§å°
- â˜ é root ç”¨æˆ¶é‹è¡Œ
- â˜ æ·»åŠ å¥åº·æª¢æŸ¥
- â˜ é…ç½®å¤–éƒ¨åŒ–

**K8s éƒ¨ç½²ï¼š**
- â˜ ç·¨å¯« Deployment/StatefulSet
- â˜ é…ç½® Service
- â˜ è¨­ç½®è³‡æºé™åˆ¶
- â˜ é…ç½® ConfigMap/Secret
- â˜ é…ç½® PV/PVCï¼ˆå¦‚éœ€è¦ï¼‰
- â˜ è¨­ç½®å¥åº·æª¢æŸ¥
- â˜ é…ç½® Ingressï¼ˆå°å¤–æœå‹™ï¼‰

**æ¸¬è©¦ï¼š**
- â˜ æœ¬åœ°æ¸¬è©¦ï¼ˆKind/k3dï¼‰
- â˜ åŠŸèƒ½æ¸¬è©¦
- â˜ æ€§èƒ½æ¸¬è©¦
- â˜ æ•…éšœæ¢å¾©æ¸¬è©¦
- â˜ æ•¸æ“šé·ç§»é©—è­‰

**ä¸Šç·šï¼š**
- â˜ ç°åº¦ç™¼å¸ƒç­–ç•¥
- â˜ ç›£æ§é…ç½®
- â˜ æ—¥èªŒæ”¶é›†
- â˜ å‘Šè­¦è¨­ç½®
- â˜ å›æ»¾æ–¹æ¡ˆ

---

## 7. å°çµ

æœ¬ç« ä»‹ç´¹äº†æ‡‰ç”¨å®¹å™¨åŒ–èˆ‡é·ç§»åˆ° Kubernetes çš„å®Œæ•´æµç¨‹ï¼š

**æ ¸å¿ƒè¦é»ï¼š**
- âœ… **Dockerfile å„ªåŒ–**ï¼šå¤šéšæ®µæ§‹å»ºã€alpine é¡åƒã€é root ç”¨æˆ¶
- âœ… **é…ç½®å¤–éƒ¨åŒ–**ï¼šç’°å¢ƒè®Šé‡ã€ConfigMapã€Secret
- âœ… **å­˜å„²ç­–ç•¥**ï¼šæ ¹æ“šéœ€æ±‚é¸æ“‡ emptyDirã€PV æˆ–å°è±¡å­˜å„²
- âœ… **å¥åº·æª¢æŸ¥**ï¼šliveness å’Œ readiness probe å¿…ä¸å¯å°‘
- âœ… **åˆ†éšæ®µé·ç§»**ï¼šå¾ç„¡ç‹€æ…‹åˆ°æœ‰ç‹€æ…‹ï¼Œé€æ­¥æ¨é€²

**é·ç§»ç­–ç•¥ï¼š**
- ğŸ¯ ç„¡ç‹€æ…‹æ‡‰ç”¨ï¼šå¿«é€Ÿå®¹å™¨åŒ–ä¸¦éƒ¨ç½²
- ğŸ¯ æœ‰ç‹€æ…‹æ‡‰ç”¨ï¼šä½¿ç”¨è¨—ç®¡æœå‹™æˆ– StatefulSet
- ğŸ¯ å–®é«”æ‡‰ç”¨ï¼šé€æ­¥æ‹†åˆ†æˆ–æ•´é«”å®¹å™¨åŒ–

ä¸‹ä¸€ç« å°‡æ·±å…¥å­¸ç¿’ Kubernetes çš„é…ç½®ç®¡ç†èˆ‡æœ€ä½³å¯¦è¸ï¼ŒåŒ…æ‹¬ ConfigMapã€Secret å’Œ Helmã€‚
