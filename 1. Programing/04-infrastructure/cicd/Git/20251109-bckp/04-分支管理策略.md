# 4.1 分支管理策略總覽

分支管理策略是團隊協作與軟體開發流程中不可或缺的一環。透過合理的分支規劃，可以有效隔離功能開發、修復、測試與發佈，降低衝突與回溯風險，提升專案品質與交付效率。核心概念在於：根據專案需求與團隊規模，選擇合適的分支模型，並配合自動化工具與嚴謹的流程規範，確保每一次合併都可追溯、可控。

---

# 4.2 Git Flow 流程與實作

## 用途與核心概念

Git Flow 是 Vincent Driessen 提出的經典分支管理模型，適合有明確發佈節奏與多階段測試的專案。其核心在於將開發、測試、發佈等階段明確分離，並以多條長期分支（如 `master`、`develop`）與短期分支（如 `feature`、`release`、`hotfix`）協同運作。

## 詳細原理說明

- `master`：僅存放正式發佈版本。
- `develop`：日常開發主線，所有新功能與修正最終都會合併至此。
- `feature/*`：功能開發分支，從 `develop` 分出，完成後合併回 `develop`。
- `release/*`：發佈前穩定分支，從 `develop` 分出，修正 bug 後合併至 `master` 與 `develop`。
- `hotfix/*`：緊急修補分支，從 `master` 分出，修正後合併回 `master` 與 `develop`。

## 常用命令與語法範例

```bash
# 建立新功能分支
git checkout develop
git checkout -b feature/login

# 完成功能後合併回 develop
git checkout develop
git merge feature/login
git branch -d feature/login

# 建立發佈分支
git checkout develop
git checkout -b release/1.0.0

# 發佈後合併至 master 並打 tag
git checkout master
git merge release/1.0.0
git tag v1.0.0

# 緊急修補
git checkout master
git checkout -b hotfix/1.0.1
# 修正後
git checkout master
git merge hotfix/1.0.1
git checkout develop
git merge hotfix/1.0.1
```

## 實際開發場景與案例

適合大型專案、需多階段測試與多版本維護的團隊。例如 ERP、金融系統等。

## 最佳實踐與常見錯誤排查

- 嚴格限制誰能操作 `master`、`develop`。
- 定期同步 `develop` 與 `master`，避免分支漂移。
- 常見錯誤：分支命名不一致、合併順序錯誤、遺漏 hotfix 回合併 develop。

---

# 4.3 GitHub Flow 流程與實作

## 用途與核心概念

GitHub Flow 強調簡潔、快速迭代，適合持續交付（CD）的雲端應用。僅以 `main`（或 `master`）為主線，所有開發皆以短期分支（feature branch）進行，透過 Pull Request（PR）審查與自動化測試。

## 詳細原理說明

- `main`：唯一穩定分支，隨時可部署。
- 功能分支：從 `main` 分出，完成後發送 PR，經審查與測試通過後合併。

## 常用命令與語法範例

```bash
# 建立功能分支
git checkout main
git checkout -b add-login

# 推送至遠端
git push origin add-login

# 發送 Pull Request，經審查後合併
# 合併後刪除分支
git branch -d add-login
git push origin --delete add-login
```

## 實際開發場景與案例

適合 SaaS、Web 應用等需快速迭代、頻繁部署的團隊。

## 最佳實踐與常見錯誤排查

- 每個 PR 必須通過自動化測試與審查。
- 避免長期未合併的分支。
- 常見錯誤：直接推送至 main、未經審查合併。

---

# 4.4 GitLab Flow 流程與實作

## 用途與核心概念

GitLab Flow 結合 Git Flow 與 GitHub Flow 優點，強調與 CI/CD、Issue、環境部署整合。可根據專案需求選擇「環境分支」或「功能分支」模式。

## 詳細原理說明

- Issue 驅動開發：每個功能/修正對應一個 Issue。
- 分支命名與 Issue 編號關聯（如 `feature/123-login`）。
- 支援多環境部署（如 `staging`、`production` 分支）。

## 常用命令與語法範例

```bash
# 建立與 Issue 對應的分支
git checkout main
git checkout -b feature/123-login

# 合併至 staging
git checkout staging
git merge feature/123-login

# 部署至 production
git checkout production
git merge staging
```

## 實際開發場景與案例

適合 DevOps 團隊、需多環境部署與 Issue 管理的專案。

## 最佳實踐與常見錯誤排查

- 分支命名規範化，與 Issue 關聯。
- 合併流程自動化（CI/CD）。
- 常見錯誤：分支未關聯 Issue、環境分支未同步。

---

# 4.5 Trunk-based Development 流程

## 用途與核心概念

Trunk-based Development（主幹開發）強調所有人都在同一主線（`main` 或 `trunk`）上協作，僅允許極短期分支，追求極速整合與持續交付。

## 詳細原理說明

- 所有開發直接在主幹或極短期分支（如一天內）完成並合併。
- 強制頻繁整合，減少分支漂移與合併衝突。
- 配合 Feature Toggle 控制未完成功能。

## 常用命令與語法範例

```bash
# 直接在 main 上開發或建立短期分支
git checkout main
git pull
# 開發後直接 commit & push
git commit -am "fix: 修正登入流程"
git push origin main

# 或建立短期分支
git checkout -b quick-fix
# 完成後馬上合併
git checkout main
git merge quick-fix
git branch -d quick-fix
```

## 實際開發場景與案例

適合追求極速交付、DevOps、微服務架構團隊。

## 最佳實踐與常見錯誤排查

- 強制自動化測試與靜態檢查。
- 配合 Feature Toggle，避免未完成功能外露。
- 常見錯誤：分支存活過久、測試覆蓋不足。

---

# 4.6 其他分支策略比較與選型建議

| 策略          | 適用場景         | 優點               | 缺點            |
| ----------- | ------------ | ---------------- | ------------- |
| Git Flow    | 大型、嚴謹發佈      | 階段分明、易於維護        | 分支多、流程繁瑣      |
| GitHub Flow | 快速迭代、雲端應用    | 流程簡單、易自動化        | 不適合多版本維護      |
| GitLab Flow | DevOps、多環境部署 | 與 CI/CD、Issue 整合 | 需配合 GitLab 生態 |
| Trunk-based | 極速交付、微服務     | 衝突少、整合快          | 需高自動化與紀律      |

**選型建議：**
- 小型團隊、快速迭代：GitHub Flow、Trunk-based。
- 大型專案、多階段測試：Git Flow、GitLab Flow。
- DevOps、持續交付：Trunk-based、GitLab Flow。

---

# 4.7 團隊協作下的分支管理實戰

- 制定明確分支命名規範（如 `feature/`, `bugfix/`, `hotfix/`）。
- 配合 CI/CD，強制 Pull Request 審查與自動化測試。
- 定期清理過期分支，避免倉庫雜亂。
- 設定分支保護規則，限制直接推送主線。
- 以 Issue、Merge Request 驅動開發，提升可追溯性。

---

# 4.8 進階技巧與最佳實踐

## 進階技巧

- **Rebase 合併**：保持 commit 歷史乾淨，減少無意義的 merge commit。
  ```bash
  git checkout feature/login
  git fetch origin
  git rebase origin/develop
  ```
- **Squash Merge**：合併時壓縮多個 commit，保持主線簡潔。
- **Cherry-pick**：將特定 commit 應用到其他分支，常用於熱修補。
  ```bash
  git checkout master
  git cherry-pick <commit-hash>
  ```
- **Git Hooks**：自動化檢查、格式化、測試等流程。
- **分支保護規則**：設定強制審查、禁止直接推送等。

## 最佳實踐

- 每日同步主線，減少合併衝突。
- Commit 訊息規範化（如 Conventional Commits）。
- 配合自動化工具（如 CI/CD、Lint、Test）。
- 定期回顧分支策略，隨團隊成長調整。

## 常見錯誤排查

- 分支未及時合併導致大規模衝突。
- 熱修補未同步回開發分支。
- 分支命名混亂、難以追蹤。
- 忽略自動化測試，導致主線不穩定。

---

本章節內容適用於工程師面試、團隊實務與大型專案規劃，建議依團隊規模與專案特性選擇最合適的分支管理策略，並持續優化流程。