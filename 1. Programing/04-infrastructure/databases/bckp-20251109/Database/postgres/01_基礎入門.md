# 01 基礎入門

## 1. PostgreSQL 架構簡介

### 理論說明
PostgreSQL 是一套功能強大的開源關聯式資料庫管理系統（RDBMS），以穩定性、擴充性與標準相容性著稱。其設計強調 ACID 交易、資料一致性與高擴展能力，廣泛應用於企業級應用、Web 服務與資料分析領域。

### 組成元件
- **Postmaster（主控程序）**：負責啟動、管理資料庫服務與監控連線。
- **Backend Process（後端程序）**：每個用戶端連線都會啟動一個獨立的後端程序，處理 SQL 請求。
- **Shared Buffers（共享緩衝區）**：用於快取資料頁面，提高存取效能。
- **WAL（Write-Ahead Logging）**：確保資料安全與交易一致性。
- **Background Workers（背景工作者）**：如自動清理（autovacuum）、檔案同步（checkpointer）等。

### 運作流程
1. 用戶端透過網路協定（預設 port 5432）連線至 postmaster。
2. postmaster 為每個連線 fork 一個 backend process。
3. backend process 處理 SQL 指令，存取資料表、索引等物件。
4. 所有寫入操作先記錄於 WAL，確保異常時可還原。
5. 背景工作者定期維護資料庫健康與效能。

---

## 2. 安裝教學

### 理論說明
PostgreSQL 支援多平台（Linux、macOS、Windows），官方建議使用套件管理工具或官方安裝包，確保版本一致與安全性。

### 官方建議
- **Linux**：優先使用發行版套件管理器（如 apt、yum）。
- **macOS**：建議使用 Homebrew。
- **Windows**：使用官方安裝程式或 Chocolatey。

### 常見安裝指令

#### Linux（Debian/Ubuntu）
```bash
sudo apt update
sudo apt install postgresql postgresql-contrib
```

#### Linux（CentOS/RHEL）
```bash
sudo yum install postgresql-server postgresql-contrib
sudo postgresql-setup initdb
sudo systemctl enable postgresql
sudo systemctl start postgresql
```

#### macOS（Homebrew）
```bash
brew update
brew install postgresql
brew services start postgresql
```

#### Windows（Chocolatey）
```powershell
choco install postgresql
```
或至 [官方下載頁](https://www.postgresql.org/download/windows/) 取得安裝程式。

### 實務建議
- 安裝後請立即設定資料庫密碼與權限。
- 定期更新 PostgreSQL 以獲得安全修補。
- 生產環境建議使用 LTS 版本，並避免 root 權限執行服務。

---

## 3. 基本用法

### 理論說明
掌握服務啟動、連線、資料庫操作與基本 SQL 指令，是有效管理 PostgreSQL 的基礎。

### 啟動/停止服務

#### Linux（systemd）
```bash
sudo systemctl start postgresql
sudo systemctl stop postgresql
sudo systemctl status postgresql
```

#### macOS（Homebrew）
```bash
brew services start postgresql
brew services stop postgresql
```

#### Windows（服務管理員）
於「服務」中啟動或停止 PostgreSQL，或使用：
```powershell
net start postgresql
net stop postgresql
```

### 連線資料庫
使用 `psql` 命令列工具：
```bash
psql -U postgres
```
- `-U` 指定用戶名，預設為 `postgres`。
- 可加 `-d` 指定資料庫名稱，`-h` 指定主機。

### 建立/刪除資料庫

#### 建立資料庫
```sql
CREATE DATABASE example_db;
```

#### 刪除資料庫
```sql
DROP DATABASE example_db;
```

### 基本 SQL 操作

#### 建立資料表
```sql
CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  username VARCHAR(50) NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### 插入資料
```sql
INSERT INTO users (username) VALUES ('alice');
```

#### 查詢資料
```sql
SELECT * FROM users;
```

#### 更新資料
```sql
UPDATE users SET username = 'bob' WHERE id = 1;
```

#### 刪除資料
```sql
DELETE FROM users WHERE id = 1;
```

### 實務建議與最佳實踐
- **權限管理**：避免以超級用戶（postgres）執行日常操作，請為應用建立專屬帳號。
- **備份與還原**：定期使用 `pg_dump`、`pg_restore` 進行備份與測試還原。
- **SQL 標準化**：撰寫 SQL 時遵循官方語法，便於維護與移植。
- **監控與調校**：善用 `pg_stat_activity`、`EXPLAIN` 等工具監控效能。
- **安全性**：設定強密碼、限制外部連線、定期更新。

---

## 參考資料
- [PostgreSQL 官方文件](https://www.postgresql.org/docs/)
- [PostgreSQL: The World's Most Advanced Open Source Relational Database](https://www.postgresql.org/)
