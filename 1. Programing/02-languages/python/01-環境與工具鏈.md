# 01-ç’°å¢ƒèˆ‡å·¥å…·éˆ

## ðŸ“– æ ¸å¿ƒæ¦‚å¿µ

Python é–‹ç™¼ç’°å¢ƒçš„æ ¸å¿ƒè¦ç´ ï¼š
- **Python ç‰ˆæœ¬ç®¡ç†**: pyenv, uv
- **å¥—ä»¶ç®¡ç†**: pip, uv, poetry
- **è™›æ“¬ç’°å¢ƒ**: venv, virtualenv
- **ç¨‹å¼ç¢¼å“è³ª**: ruff, black, mypy

```mermaid
graph LR
    A[é–‹ç™¼ç’°å¢ƒ] --> B[Python ç‰ˆæœ¬]
    A --> C[è™›æ“¬ç’°å¢ƒ]
    A --> D[ä¾è³´ç®¡ç†]
    A --> E[ç¨‹å¼ç¢¼å“è³ª]
    
    B --> B1[pyenv]
    B --> B2[uv python]
    
    C --> C1[venv]
    C --> C2[uv venv]
    
    D --> D1[pip]
    D --> D2[uv]
    D --> D3[poetry]
    
    E --> E1[ruff]
    E --> E2[black]
    E --> E3[mypy]
```

## ðŸ”§ uv - ç¾ä»£åŒ– Python å·¥å…·éˆ

uv æ˜¯ç”¨ Rust ç·¨å¯«çš„æ¥µé€Ÿ Python å¥—ä»¶ç®¡ç†å™¨ï¼Œæ•´åˆäº†å°ˆæ¡ˆç®¡ç†ã€ä¾è³´è§£æžã€è™›æ“¬ç’°å¢ƒç­‰åŠŸèƒ½ã€‚

### Python ç‰ˆæœ¬ç®¡ç†

```bash
# åˆ—å‡ºå¯ç”¨ç‰ˆæœ¬
uv python list

# å®‰è£ Python ç‰ˆæœ¬
uv python install 3.12
uv python install 3.13

# å¸è¼‰ç‰ˆæœ¬
uv python uninstall 3.12

# è¨­å®šå°ˆæ¡ˆä½¿ç”¨çš„ Python ç‰ˆæœ¬
uv python pin 3.13
```

### å°ˆæ¡ˆç®¡ç†

#### åˆå§‹åŒ–å°ˆæ¡ˆ

```bash
# æ–¹å¼ä¸€ï¼šåœ¨ç¾æœ‰ç›®éŒ„åˆå§‹åŒ–
mkdir myproject && cd myproject
uv init

# æ–¹å¼äºŒï¼šå‰µå»ºæ–°å°ˆæ¡ˆ
uv init myproject --python 3.13

# å°ˆæ¡ˆçµæ§‹
# myproject/
# â”œâ”€â”€ .python-version      # Python ç‰ˆæœ¬
# â”œâ”€â”€ pyproject.toml       # å°ˆæ¡ˆé…ç½®
# â”œâ”€â”€ uv.lock              # ä¾è³´éŽ–å®š
# â””â”€â”€ src/
#     â””â”€â”€ myproject/
#         â””â”€â”€ __init__.py
```

#### pyproject.toml ç¯„ä¾‹

```toml
[project]
name = "myproject"
version = "0.1.0"
description = "A modern Python project"
requires-python = ">=3.13"
dependencies = [
    "fastapi>=0.115.0",
    "uvicorn>=0.32.0",
    "pydantic>=2.9.0",
]

[project.optional-dependencies]
dev = [
    "pytest>=8.3.0",
    "ruff>=0.7.0",
    "mypy>=1.13.0",
]

[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[tool.ruff]
line-length = 100
target-version = "py313"
```

### ä¾è³´ç®¡ç†

```bash
# æ·»åŠ ä¾è³´ï¼ˆè‡ªå‹•å¯«å…¥ pyproject.tomlï¼‰
uv add fastapi uvicorn pydantic

# æ·»åŠ é–‹ç™¼ä¾è³´
uv add --dev pytest ruff mypy

# å¾ž requirements.txt é·ç§»
uv add -r requirements.txt

# ç§»é™¤ä¾è³´
uv remove requests

# æ›´æ–°ä¾è³´åˆ°æœ€æ–°å…¼å®¹ç‰ˆæœ¬
uv lock --upgrade-package fastapi

# æ›´æ–°æ‰€æœ‰ä¾è³´
uv lock --upgrade

# æŸ¥çœ‹ä¾è³´æ¨¹
uv tree
```

### åŸ·è¡Œèˆ‡é–‹ç™¼

```bash
# åŒæ­¥ä¾è³´ï¼ˆæ ¹æ“š lock æª”å®‰è£ï¼‰
uv sync

# åŒæ­¥é–‹ç™¼ä¾è³´
uv sync --all-extras

# åŸ·è¡Œ Python ç¨‹å¼
uv run main.py

# åŸ·è¡Œ Python æŒ‡ä»¤
uv run python -c "print('Hello')"

# åŸ·è¡Œæ¨¡çµ„
uv run -m pytest

# é€²å…¥è™›æ“¬ç’°å¢ƒ
source .venv/bin/activate  # Linux/macOS
.venv\Scripts\activate     # Windows
```

### å·¥å…·ç®¡ç†

```bash
# åŸ·è¡Œä¸€æ¬¡æ€§å·¥å…·ï¼ˆä¸å®‰è£ï¼‰
uvx ruff check .
uvx black .
uvx pytest

# å®‰è£å…¨åŸŸå·¥å…·
uv tool install ruff
uv tool install black
uv tool install mypy

# åˆ—å‡ºå·²å®‰è£å·¥å…·
uv tool list

# å¸è¼‰å·¥å…·
uv tool uninstall ruff

# æ›´æ–° shell ç’°å¢ƒè®Šæ•¸
uv tool update-shell
```

### æ‰“åŒ…èˆ‡ç™¼å¸ƒ

```bash
# æ‰“åŒ…å°ˆæ¡ˆ
uv build

# ç”¢å‡ºçµæžœ
# dist/
# â”œâ”€â”€ myproject-0.1.0.tar.gz           # source distribution
# â””â”€â”€ myproject-0.1.0-py3-none-any.whl # wheel

# ç™¼å¸ƒåˆ° PyPI
uv publish --token $PYPI_TOKEN
```

## ðŸ”§ å‚³çµ±å·¥å…·éˆ

### venv - å…§å»ºè™›æ“¬ç’°å¢ƒ

```bash
# å‰µå»ºè™›æ“¬ç’°å¢ƒ
python -m venv .venv

# å•Ÿå‹•è™›æ“¬ç’°å¢ƒ
source .venv/bin/activate  # Linux/macOS
.venv\Scripts\activate     # Windows

# åœç”¨
deactivate
```

### pip - å¥—ä»¶ç®¡ç†

```bash
# å®‰è£å¥—ä»¶
pip install requests

# å®‰è£ç‰¹å®šç‰ˆæœ¬
pip install requests==2.31.0

# å®‰è£é–‹ç™¼æ¨¡å¼ï¼ˆå¯ç·¨è¼¯ï¼‰
pip install -e .

# å‡çµä¾è³´
pip freeze > requirements.txt

# å¾ž requirements.txt å®‰è£
pip install -r requirements.txt

# å‡ç´šå¥—ä»¶
pip install --upgrade requests

# å¸è¼‰
pip uninstall requests
```

### pyenv - Python ç‰ˆæœ¬ç®¡ç†

```bash
# åˆ—å‡ºå¯å®‰è£ç‰ˆæœ¬
pyenv install --list

# å®‰è£ Python
pyenv install 3.13.0

# è¨­å®šå…¨åŸŸç‰ˆæœ¬
pyenv global 3.13.0

# è¨­å®šæœ¬åœ°ç‰ˆæœ¬ï¼ˆå°ˆæ¡ˆç›®éŒ„ï¼‰
pyenv local 3.13.0

# åˆ—å‡ºå·²å®‰è£ç‰ˆæœ¬
pyenv versions
```

## ðŸ”§ ç¨‹å¼ç¢¼å“è³ªå·¥å…·

### Ruff - æ¥µé€Ÿ Linter & Formatter

```bash
# æª¢æŸ¥ç¨‹å¼ç¢¼
ruff check .

# è‡ªå‹•ä¿®å¾©
ruff check --fix .

# æ ¼å¼åŒ–
ruff format .

# é…ç½® pyproject.toml
```

```toml
[tool.ruff]
line-length = 100
target-version = "py313"

[tool.ruff.lint]
select = [
    "E",   # pycodestyle errors
    "W",   # pycodestyle warnings
    "F",   # pyflakes
    "I",   # isort
    "B",   # flake8-bugbear
    "C4",  # flake8-comprehensions
    "UP",  # pyupgrade
]
ignore = ["E501"]  # å¿½ç•¥è¡Œé•·åº¦

[tool.ruff.format]
quote-style = "double"
indent-style = "space"
```

### Mypy - éœæ…‹åž‹åˆ¥æª¢æŸ¥

```bash
# æª¢æŸ¥åž‹åˆ¥
mypy src/

# é…ç½®
```

```toml
[tool.mypy]
python_version = "3.13"
strict = true
warn_return_any = true
warn_unused_configs = true
disallow_untyped_defs = true
```

## ðŸ’¡ å¯¦æˆ°æ¡ˆä¾‹ï¼šFastAPI å°ˆæ¡ˆåˆå§‹åŒ–

```bash
# 1. å‰µå»ºå°ˆæ¡ˆ
uv init fastapi-app --python 3.13
cd fastapi-app

# 2. æ·»åŠ ä¾è³´
uv add fastapi uvicorn[standard] pydantic pydantic-settings
uv add --dev pytest httpx ruff mypy

# 3. å‰µå»ºå°ˆæ¡ˆçµæ§‹
mkdir -p src/app/{api,core,models,services}
touch src/app/{__init__,main,config}.py
touch src/app/api/__init__.py
touch src/app/core/__init__.py

# 4. è¨­å®šå·¥å…·
cat >> pyproject.toml << 'EOF'

[tool.ruff]
line-length = 100

[tool.ruff.lint]
select = ["E", "F", "I", "B", "UP"]

[tool.mypy]
strict = true
EOF

# 5. åŸ·è¡Œ
uv run uvicorn app.main:app --reload
```

### å°ˆæ¡ˆçµæ§‹ç¯„ä¾‹

```
fastapi-app/
â”œâ”€â”€ .python-version
â”œâ”€â”€ pyproject.toml
â”œâ”€â”€ uv.lock
â”œâ”€â”€ README.md
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ test_api.py
â””â”€â”€ src/
    â””â”€â”€ app/
        â”œâ”€â”€ __init__.py
        â”œâ”€â”€ main.py
        â”œâ”€â”€ config.py
        â”œâ”€â”€ api/
        â”‚   â”œâ”€â”€ __init__.py
        â”‚   â””â”€â”€ routes.py
        â”œâ”€â”€ core/
        â”‚   â”œâ”€â”€ __init__.py
        â”‚   â””â”€â”€ security.py
        â”œâ”€â”€ models/
        â”‚   â”œâ”€â”€ __init__.py
        â”‚   â””â”€â”€ user.py
        â””â”€â”€ services/
            â”œâ”€â”€ __init__.py
            â””â”€â”€ user_service.py
```

## âš ï¸ å¸¸è¦‹é™·é˜±

1. **æ··ç”¨å¥—ä»¶ç®¡ç†å·¥å…·**
   ```bash
   # âŒ ä¸è¦æ··ç”¨
   uv add requests
   pip install httpx  # æœƒç ´å£žä¾è³´ç®¡ç†
   
   # âœ… çµ±ä¸€ä½¿ç”¨ä¸€ç¨®å·¥å…·
   uv add requests httpx
   ```

2. **å¿˜è¨˜å•Ÿå‹•è™›æ“¬ç’°å¢ƒ**
   ```bash
   # âŒ ç›´æŽ¥åŸ·è¡Œå¯èƒ½ä½¿ç”¨ç³»çµ± Python
   python main.py
   
   # âœ… ä½¿ç”¨ uv run æˆ–å•Ÿå‹•è™›æ“¬ç’°å¢ƒ
   uv run main.py
   # æˆ–
   source .venv/bin/activate && python main.py
   ```

3. **ä¾è³´ç‰ˆæœ¬æœªéŽ–å®š**
   ```toml
   # âŒ ä¸æŒ‡å®šç‰ˆæœ¬å¯èƒ½å°Žè‡´ä¸å¯é‡ç¾
   dependencies = ["fastapi"]
   
   # âœ… ä½¿ç”¨ uv.lock æˆ–æŒ‡å®šç‰ˆæœ¬ç¯„åœ
   dependencies = ["fastapi>=0.115.0,<0.116.0"]
   ```

4. **æäº¤è™›æ“¬ç’°å¢ƒåˆ°ç‰ˆæœ¬æŽ§åˆ¶**
   ```gitignore
   # .gitignore
   .venv/
   __pycache__/
   *.pyc
   .pytest_cache/
   .mypy_cache/
   .ruff_cache/
   ```

## ðŸ“Š å·¥å…·æ¯”è¼ƒ

| å·¥å…· | é€Ÿåº¦ | åŠŸèƒ½ | ç”Ÿæ…‹ç³»çµ± | æŽ¨è–¦åº¦ |
|------|------|------|----------|--------|
| uv | â­â­â­â­â­ | å…¨å¥—å·¥å…·éˆ | æ–°èˆˆ | â­â­â­â­â­ |
| poetry | â­â­â­ | å°ˆæ¡ˆç®¡ç† | æˆç†Ÿ | â­â­â­â­ |
| pip + venv | â­â­ | åŸºç¤ŽåŠŸèƒ½ | å®˜æ–¹æ¨™æº– | â­â­â­ |
| conda | â­â­ | ç§‘å­¸è¨ˆç®— | è·¨èªžè¨€ | â­â­â­ |

## ðŸ’¡ æœ€ä½³å¯¦è¸

1. **ä½¿ç”¨ uv é€²è¡Œç¾ä»£åŒ–é–‹ç™¼**
2. **æ¯å€‹å°ˆæ¡ˆä½¿ç”¨ç¨ç«‹è™›æ“¬ç’°å¢ƒ**
3. **éŽ–å®šä¾è³´ç‰ˆæœ¬ï¼ˆuv.lockï¼‰**
4. **ä½¿ç”¨ ruff çµ±ä¸€ç¨‹å¼ç¢¼é¢¨æ ¼**
5. **å•Ÿç”¨ mypy åž‹åˆ¥æª¢æŸ¥**
6. **é…ç½® pre-commit hooks**
7. **æ–‡ä»¶åŒ–å°ˆæ¡ˆè¨­ç½®ï¼ˆREADME.mdï¼‰**

```bash
# .git/hooks/pre-commit ç¯„ä¾‹
#!/bin/bash
uv run ruff check .
uv run ruff format --check .
uv run mypy src/
uv run pytest
```
