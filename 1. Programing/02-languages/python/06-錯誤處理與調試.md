# 06-éŒ¯èª¤è™•ç†èˆ‡èª¿è©¦

## ğŸ“– æ ¸å¿ƒæ¦‚å¿µ

- **ç•°å¸¸è™•ç†**: try/except/finally
- **è‡ªè¨‚ç•°å¸¸**: Exception é¡ç¹¼æ‰¿
- **æ—¥èªŒç³»çµ±**: logging æ¨¡çµ„
- **èª¿è©¦å·¥å…·**: pdb, breakpoint()
- **é¡å‹æª¢æŸ¥**: mypy

```mermaid
graph TD
    A[éŒ¯èª¤è™•ç†èˆ‡èª¿è©¦] --> B[ç•°å¸¸è™•ç†]
    A --> C[æ—¥èªŒç³»çµ±]
    A --> D[èª¿è©¦å·¥å…·]
    A --> E[æœ€ä½³å¯¦è¸]
    
    B --> B1[try/except]
    B --> B2[è‡ªè¨‚ç•°å¸¸]
    B --> B3[ä¸Šä¸‹æ–‡ç®¡ç†å™¨]
    
    C --> C1[logging]
    C --> C2[æ—¥èªŒç´šåˆ¥]
    C --> C3[Handler]
    
    D --> D1[pdb]
    D --> D2[breakpoint]
    D --> D3[printèª¿è©¦]
```

## ğŸ”§ ç•°å¸¸è™•ç†

### åŸºç¤ try/except

```python
try:
    result = 10 / 0
except ZeroDivisionError as e:
    print(f"Error: {e}")
except ValueError:
    print("Value error occurred")
except (TypeError, KeyError) as e:
    print(f"Type or Key error: {e}")
except Exception as e:
    print(f"Unexpected error: {e}")
finally:
    print("Cleanup code")
```

### è‡ªè¨‚ç•°å¸¸

```python
class ValidationError(Exception):
    def __init__(self, field: str, message: str):
        self.field = field
        self.message = message
        super().__init__(f"{field}: {message}")

class User:
    def __init__(self, email: str, age: int):
        if "@" not in email:
            raise ValidationError("email", "Invalid email format")
        if age < 0:
            raise ValidationError("age", "Age cannot be negative")
        self.email = email
        self.age = age

try:
    user = User("invalid-email", 25)
except ValidationError as e:
    print(f"Validation failed: {e}")
```

### ç•°å¸¸éˆ

```python
class DatabaseError(Exception):
    pass

def connect_to_db():
    try:
        raise ConnectionError("Cannot connect to database")
    except ConnectionError as e:
        raise DatabaseError("Database operation failed") from e

try:
    connect_to_db()
except DatabaseError as e:
    print(f"Error: {e}")
    print(f"Caused by: {e.__cause__}")
```

## ğŸ”§ æ—¥èªŒç³»çµ±

### åŸºç¤é…ç½®

```python
import logging

logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('app.log'),
        logging.StreamHandler()
    ]
)

logger = logging.getLogger(__name__)

logger.debug("Debug message")
logger.info("Info message")
logger.warning("Warning message")
logger.error("Error message")
logger.critical("Critical message")
```

### å¯¦æˆ°é…ç½®

```python
import logging
from logging.handlers import RotatingFileHandler

def setup_logging():
    logger = logging.getLogger('myapp')
    logger.setLevel(logging.DEBUG)
    
    formatter = logging.Formatter(
        '%(asctime)s - %(name)s - %(levelname)s - %(message)s'
    )
    
    file_handler = RotatingFileHandler(
        'app.log',
        maxBytes=10485760,  # 10MB
        backupCount=5
    )
    file_handler.setLevel(logging.INFO)
    file_handler.setFormatter(formatter)
    
    console_handler = logging.StreamHandler()
    console_handler.setLevel(logging.DEBUG)
    console_handler.setFormatter(formatter)
    
    logger.addHandler(file_handler)
    logger.addHandler(console_handler)
    
    return logger

logger = setup_logging()
logger.info("Application started")
```

## ğŸ”§ èª¿è©¦å·¥å…·

### pdb èª¿è©¦å™¨

```python
import pdb

def calculate(x, y):
    result = x + y
    pdb.set_trace()  # è¨­ç½®æ–·é»
    return result * 2

calculate(5, 3)
```

### breakpoint() (Python 3.7+)

```python
def process_data(data):
    result = []
    for item in data:
        breakpoint()  # æ›´ç¾ä»£çš„æ–·é»æ–¹å¼
        result.append(item * 2)
    return result

process_data([1, 2, 3])
```

## ğŸ’¡ æœ€ä½³å¯¦è¸

```python
import logging
from typing import Optional

logger = logging.getLogger(__name__)

class DataProcessor:
    def process(self, data: list) -> Optional[list]:
        try:
            logger.info(f"Processing {len(data)} items")
            result = [self._transform(item) for item in data]
            logger.info("Processing completed successfully")
            return result
        except ValueError as e:
            logger.error(f"Validation error: {e}", exc_info=True)
            raise
        except Exception as e:
            logger.critical(f"Unexpected error: {e}", exc_info=True)
            return None
    
    def _transform(self, item):
        if item < 0:
            raise ValueError("Item must be non-negative")
        return item * 2
```

## âš ï¸ å¸¸è¦‹é™·é˜±

```python
# âŒ æ•ç²éæ–¼å¯¬æ³›
try:
    do_something()
except:  # æœƒæ•ç²æ‰€æœ‰ç•°å¸¸åŒ…æ‹¬ KeyboardInterrupt
    pass

# âœ… å…·é«”æ•ç²
try:
    do_something()
except ValueError:
    handle_value_error()
except Exception as e:
    logger.error(f"Error: {e}")
    raise

# âŒ ç©ºçš„ except
try:
    risky_operation()
except:
    pass  # éŒ¯èª¤è¢«å¿½ç•¥

# âœ… æ­£ç¢ºè™•ç†
try:
    risky_operation()
except Exception as e:
    logger.error(f"Operation failed: {e}")
    handle_error(e)
```
