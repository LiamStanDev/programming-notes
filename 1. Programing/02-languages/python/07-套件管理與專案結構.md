# 07-å¥—ä»¶ç®¡ç†èˆ‡å°ˆæ¡ˆçµæ§‹

## ðŸ“– æ ¸å¿ƒæ¦‚å¿µ

- **å°ˆæ¡ˆçµæ§‹**: src layout, flat layout
- **pyproject.toml**: å°ˆæ¡ˆé…ç½®
- **æ‰“åŒ…ç™¼å¸ƒ**: build, publish
- **ä¾è³´ç®¡ç†**: uv, poetry

```mermaid
graph TD
    A[å°ˆæ¡ˆç®¡ç†] --> B[å°ˆæ¡ˆçµæ§‹]
    A --> C[é…ç½®æ–‡ä»¶]
    A --> D[æ‰“åŒ…ç™¼å¸ƒ]
    
    B --> B1[src layout]
    B --> B2[flat layout]
    
    C --> C1[pyproject.toml]
    C --> C2[setup.py]
    
    D --> D1[build]
    D --> D2[publish]
```

## ðŸ”§ å°ˆæ¡ˆçµæ§‹

### Src Layout (æŽ¨è–¦)

```
myproject/
â”œâ”€â”€ .gitignore
â”œâ”€â”€ .python-version
â”œâ”€â”€ pyproject.toml
â”œâ”€â”€ uv.lock
â”œâ”€â”€ README.md
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ conftest.py
â”‚   â””â”€â”€ test_core.py
â””â”€â”€ src/
    â””â”€â”€ myproject/
        â”œâ”€â”€ __init__.py
        â”œâ”€â”€ __main__.py
        â”œâ”€â”€ core.py
        â”œâ”€â”€ api/
        â”‚   â”œâ”€â”€ __init__.py
        â”‚   â””â”€â”€ routes.py
        â””â”€â”€ models/
            â”œâ”€â”€ __init__.py
            â””â”€â”€ user.py
```

### pyproject.toml

```toml
[project]
name = "myproject"
version = "0.1.0"
description = "A modern Python project"
readme = "README.md"
requires-python = ">=3.11"
authors = [
    {name = "Your Name", email = "you@example.com"}
]
dependencies = [
    "fastapi>=0.115.0",
    "uvicorn>=0.32.0",
]

[project.optional-dependencies]
dev = [
    "pytest>=8.0.0",
    "ruff>=0.7.0",
    "mypy>=1.13.0",
]

[project.scripts]
myproject = "myproject.__main__:main"

[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[tool.ruff]
line-length = 100
target-version = "py311"

[tool.ruff.lint]
select = ["E", "F", "I", "B", "UP"]

[tool.mypy]
python_version = "3.11"
strict = true

[tool.pytest.ini_options]
testpaths = ["tests"]
pythonpath = ["src"]
```

## ðŸ”§ æ¨¡çµ„èˆ‡å¥—ä»¶

### __init__.py

```python
# src/myproject/__init__.py
__version__ = "0.1.0"

from .core import main_function
from .models.user import User

__all__ = ["main_function", "User"]
```

### __main__.py

```python
# src/myproject/__main__.py
def main():
    print("Running myproject")

if __name__ == "__main__":
    main()
```

é‹è¡Œï¼š
```bash
python -m myproject
# æˆ–ä½¿ç”¨ uv
uv run -m myproject
```

## ðŸ”§ æ‰“åŒ…èˆ‡ç™¼å¸ƒ

### æ§‹å»ºå¥—ä»¶

```bash
# ä½¿ç”¨ uv æ§‹å»º
uv build

# ç”¢ç”Ÿçš„æ–‡ä»¶
# dist/
# â”œâ”€â”€ myproject-0.1.0.tar.gz        # source distribution
# â””â”€â”€ myproject-0.1.0-py3-none-any.whl  # wheel
```

### ç™¼å¸ƒåˆ° PyPI

```bash
# è¨­ç½® PyPI token
export PYPI_TOKEN="pypi-..."

# ç™¼å¸ƒ
uv publish --token $PYPI_TOKEN

# æ¸¬è©¦ç™¼å¸ƒåˆ° TestPyPI
uv publish --token $TEST_PYPI_TOKEN --publish-url https://test.pypi.org/legacy/
```

## ðŸ’¡ å¯¦æˆ°æ¡ˆä¾‹ï¼šCLI å·¥å…·

```
mycli/
â”œâ”€â”€ pyproject.toml
â”œâ”€â”€ README.md
â””â”€â”€ src/
    â””â”€â”€ mycli/
        â”œâ”€â”€ __init__.py
        â”œâ”€â”€ __main__.py
        â””â”€â”€ cli.py
```

```python
# src/mycli/cli.py
import argparse

def main():
    parser = argparse.ArgumentParser(description="My CLI tool")
    parser.add_argument("name", help="Your name")
    parser.add_argument("--greeting", default="Hello", help="Greeting message")
    
    args = parser.parse_args()
    print(f"{args.greeting}, {args.name}!")

if __name__ == "__main__":
    main()
```

```python
# src/mycli/__main__.py
from .cli import main

if __name__ == "__main__":
    main()
```

```toml
# pyproject.toml
[project]
name = "mycli"
version = "0.1.0"

[project.scripts]
mycli = "mycli.cli:main"
```

ä½¿ç”¨ï¼š
```bash
# é–‹ç™¼æ¨¡å¼å®‰è£
uv pip install -e .

# ä½¿ç”¨ CLI
mycli Alice
mycli Bob --greeting "Hi"
```

## ðŸ’¡ æœ€ä½³å¯¦è¸

1. **ä½¿ç”¨ src layout**
   - é¿å…æ„å¤–å°Žå…¥æœ¬åœ°æ¨¡çµ„
   - å¼·åˆ¶å®‰è£æ‰èƒ½æ¸¬è©¦

2. **ç‰ˆæœ¬ç®¡ç†**
   ```python
   # src/myproject/__init__.py
   __version__ = "0.1.0"
   ```

3. **ä¾è³´å›ºå®š**
   ```toml
   dependencies = [
       "fastapi>=0.115.0,<0.116.0",
       "pydantic>=2.9.0",
   ]
   ```

4. **æ–‡æª”åŒ–**
   - README.md: å°ˆæ¡ˆèªªæ˜Ž
   - CHANGELOG.md: ç‰ˆæœ¬è®Šæ›´
   - docs/: è©³ç´°æ–‡æª”

5. **CI/CD**
   ```yaml
   # .github/workflows/test.yml
   name: Test
   on: [push, pull_request]
   jobs:
     test:
       runs-on: ubuntu-latest
       steps:
         - uses: actions/checkout@v4
         - uses: actions/setup-python@v5
         - run: uv sync
         - run: uv run pytest
   ```
