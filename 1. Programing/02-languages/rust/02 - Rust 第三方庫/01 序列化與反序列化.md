# Serde
---
## 介紹
`serde` 是 Rust 中一個非常強大且靈活的序列化和反序列化框架。它的名字來自 "serialization" 和 "deserialization" 的縮寫。`serde` 支持多種數據格式，包括 JSON、YAML、TOML、MessagePack 等。提供了通用的序列化和反序列化功能，支持多種數據格式。它定義了序列化和反序列化的核心特性和接口。

##### 特點
1. **高效**：`serde` 的設計目標是高效地序列化和反序列化數據。
2. **靈活**：支持多種數據結構的序列化和反序列化，包括結構體、枚舉、集合等。
3. **易用**：提供簡單易用的宏和屬性來自動生成序列化和反序列化代碼

##### 安裝
在 `Cargo.toml` 中添加依賴：
```toml
[dependencies]
serde = { version = "1.0", features = ["derive"] }
```

##### 多種數據格式
1. **`serde_json`**：用於 JSON 格式的序列化和反序列化。
2. **`serde_yaml`**: 用於 YAML 格式的序列化和反序列化。
3. **`toml`**: 用於 TOML 格式的序列化和反序列化。
4. **`rmp-serde`**: 用於 MessagePack 格式的序列化和反序列化。
5. **`serde_cbor`**: 用於 CBOR 格式的序列化和反序列化。
等等...

## 使用
### Data Structure
Serde 對於 Rust 中常見的類型都可以直接進行序列化(`Vec<T>`, `HashMap<K,V>`)，自定義類型可以透過 `dervice` macro 來派生序列化功能。
```rust
use serde::{Serialize, Deserialize};

#[derive(Serialize, Deserialize, Debug)]
struct Point {
    x: i32,
    y: i32,
}
```

### Json
#### 直接操作
Json 序列化要使用 `serde_json` 庫，提供：
* **`serde_json::Value`**: 表示任意 JSON 數據，可以對其進行操作。
* **`serde_json::from_str`**: 將 `&str` 轉為 `Value` 類型。
* **`serde_json::from_slice`**: 將 `&[u8]` 轉為 `Value` 類型。
* **`serde_json::from_reader`**: 將所有 `io::Read` 類型 (File or TCP Stream) 轉為 `Value` 類型。
```rust
let data = r#"
        {
            "name": "John Doe",
            "age": 43,
            "phones": [
                "+44 1234567",
                "+44 2345678"
            ]
        }"#;

// Parse the string of data into serde_json::Value.
let v: Value = serde_json::from_str(data)?;

// Access parts of the data by indexing with square brackets.
println!("Please call {} at the number {}", v["name"], v["phones"][0]);
```

#### 強類型序列與反序列化
```rust
use serde::{Deserialize, Serialize};
use serde_json::Result;

#[derive(Serialize, Deserialize)]
struct Person {
    name: String,
    age: u8,
    phones: Vec<String>,
}

fn typed_example() -> Result<()> {
    // Some JSON input data as a &str. Maybe this comes from the user.
    let data = r#"
        {
            "name": "John Doe",
            "age": 43,
            "phones": [
                "+44 1234567",
                "+44 2345678"
            ]
        }"#;

    // Parse the string of data into a Person object. This is exactly the
    // same function as the one that produced serde_json::Value above, but
    // now we are asking it for a Person as output.
    let p: Person = serde_json::from_str(data)?;

    // Do things just like with any other Rust data structure.
    println!("Please call {} at the number {}", p.name, p.phones[0]);

    Ok(())
}
```

#### 建立 Json Value 類型
使用 `json!` 宏可以在 rust 中建立 `serde_json::Value` 類型。
```rust
let john = json!({
	"name": "John Doe",
	"age": 43,
	"phones": [
		"+44 1234567",
		"+44 2345678"
	]
});

println!("first phone number: {}", john["phones"][0]);

// Convert to a string of JSON and print it out
println!("{}", john.to_string());
```