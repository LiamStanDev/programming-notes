# è³‡æ–™æ¨¡å‹èˆ‡æŸ¥è©¢èªè¨€

## ğŸ¯ å­¸ç¿’ç›®æ¨™

æœ¬ç« å°‡å¹«åŠ©ä½ ç†è§£ï¼š
- é—œè¯å¼ã€æ–‡ä»¶å¼ã€åœ–å¼è³‡æ–™åº«çš„æ ¸å¿ƒå·®ç•°
- å¦‚ä½•æ ¹æ“šè³‡æ–™ç‰¹æ€§é¸æ“‡é©åˆçš„æ¨¡å‹
- ä¸åŒæŸ¥è©¢èªè¨€çš„è¨­è¨ˆå“²å­¸èˆ‡æ¬Šè¡¡
- NoSQL çš„èˆˆèµ·èƒŒæ™¯èˆ‡å¯¦éš›æ‡‰ç”¨
- å¤šå°å¤šé—œä¿‚çš„è™•ç†ç­–ç•¥

---

## ğŸ’¡ ç‚ºä»€éº¼è³‡æ–™æ¨¡å‹å¦‚æ­¤é‡è¦ï¼Ÿ

**è³‡æ–™æ¨¡å‹æ˜¯è»Ÿé«”é–‹ç™¼ä¸­æœ€é‡è¦çš„æ±ºå®šä¹‹ä¸€**

```mermaid
graph TD
    A["æ‡‰ç”¨ç¨‹å¼ç¢¼"] --> B["è³‡æ–™æ¨¡å‹"]
    B --> C["å¦‚ä½•å„²å­˜"]
    B --> D["å¦‚ä½•æŸ¥è©¢"]
    B --> E["å¦‚ä½•æ“´å±•"]
    
    F["é¸éŒ¯è³‡æ–™æ¨¡å‹"] --> G["ç¨‹å¼ç¢¼è¤‡é›œ"]
    F --> H["æ•ˆèƒ½ä½è½"]
    F --> I["é›£ä»¥æ“´å±•"]
```

è³‡æ–™æ¨¡å‹å½±éŸ¿ï¼š
- **å¦‚ä½•æ€è€ƒå•é¡Œ**ï¼šä½ æœƒç”¨æ¨¡å‹çš„è¡“èªæ€è€ƒ
- **è»Ÿé«”çš„å¯èƒ½æ€§**ï¼šæ¨¡å‹é™åˆ¶äº†ä½ èƒ½åšä»€éº¼
- **ç³»çµ±çš„æ•ˆèƒ½**ï¼šä¸åŒæ¨¡å‹æœ‰ä¸åŒçš„æ•ˆèƒ½ç‰¹æ€§

---

## ğŸ” é—œè¯å¼æ¨¡å‹ (Relational Model)

### æ­·å²èƒŒæ™¯

**1970 å¹´ï¼ŒEdgar Codd æå‡ºé—œè¯å¼æ¨¡å‹**

åœ¨æ­¤ä¹‹å‰ï¼š
- å±¤æ¬¡æ¨¡å‹ (Hierarchical Model) - IBM IMS
- ç¶²ç‹€æ¨¡å‹ (Network Model) - CODASYL

é—œè¯å¼æ¨¡å‹çš„é©å‘½æ€§å‰µæ–°ï¼š
- **è³‡æ–™ç¨ç«‹æ€§**ï¼šæŸ¥è©¢ä¸éœ€è¦çŸ¥é“è³‡æ–™å¦‚ä½•å„²å­˜
- **è²æ˜å¼æŸ¥è©¢**ï¼šæè¿°æƒ³è¦ä»€éº¼ï¼Œä¸æ˜¯å¦‚ä½•å–å¾—
- **æ•¸å­¸åŸºç¤**ï¼šåŸºæ–¼é›†åˆè«–èˆ‡è¬‚è©é‚è¼¯

### é—œè¯å¼æ¨¡å‹çš„æ ¸å¿ƒæ¦‚å¿µ

```mermaid
erDiagram
    USERS ||--o{ POSTS : "å¯«"
    USERS ||--o{ COMMENTS : "è©•è«–"
    POSTS ||--o{ COMMENTS : "åŒ…å«"
    
    USERS {
        int user_id PK
        string name
        string email
        date created_at
    }
    
    POSTS {
        int post_id PK
        int user_id FK
        string title
        text content
        date published_at
    }
    
    COMMENTS {
        int comment_id PK
        int user_id FK
        int post_id FK
        text content
        date created_at
    }
```

**é—œéµç‰¹æ€§**ï¼š
1. **Schema-on-Write**ï¼šå¯«å…¥å‰å¿…é ˆå®šç¾©çµæ§‹
2. **æ­£è¦åŒ– (Normalization)**ï¼šæ¸›å°‘è³‡æ–™é‡è¤‡
3. **JOIN æ“ä½œ**ï¼šçµ„åˆå¤šå€‹è¡¨æ ¼
4. **ACID ä¿è­‰**ï¼šå¼·ä¸€è‡´æ€§

### é—œè¯å¼æ¨¡å‹çš„å„ªå‹¢

```sql
-- è²æ˜å¼æŸ¥è©¢ï¼šæè¿°æƒ³è¦ä»€éº¼
SELECT u.name, COUNT(p.post_id) as post_count
FROM users u
LEFT JOIN posts p ON u.user_id = p.user_id
WHERE u.created_at > '2024-01-01'
GROUP BY u.user_id, u.name
HAVING post_count > 5
ORDER BY post_count DESC;

-- è³‡æ–™åº«è² è²¬:
-- - é¸æ“‡æœ€ä½³åŸ·è¡Œè¨ˆç•«
-- - ä½¿ç”¨é©ç•¶çš„ç´¢å¼•
-- - å„ªåŒ– JOIN é †åº
```

**å„ªå‹¢**ï¼š
- âœ… å¼·å¤§çš„æŸ¥è©¢èƒ½åŠ›
- âœ… äº‹å‹™ä¿è­‰ (ACID)
- âœ… æˆç†Ÿçš„å·¥å…·ç”Ÿæ…‹
- âœ… å»£æ³›çš„çŸ¥è­˜åŸºç¤

**åŠ£å‹¢**ï¼š
- âŒ Schema è®Šæ›´å›°é›£
- âŒ Object-Relational é˜»æŠ—ä¸åŒ¹é…
- âŒ æ°´å¹³æ“´å±•å›°é›£
- âŒ JOIN åœ¨å¤§è¦æ¨¡è³‡æ–™æ™‚æ˜‚è²´

---

## ğŸ“„ æ–‡ä»¶æ¨¡å‹ (Document Model)

### NoSQL çš„èˆˆèµ·

**2000 å¹´ä»£å¾ŒæœŸï¼ŒNoSQL é‹å‹•èˆˆèµ·**

é©…å‹•å› ç´ ï¼š
1. **è¶…å¤§è¦æ¨¡è³‡æ–™é›†**ï¼šè¶…è¶Šå–®æ©Ÿè³‡æ–™åº«å®¹é‡
2. **é«˜å¯«å…¥ååé‡**ï¼šé—œè¯å¼è³‡æ–™åº«é›£ä»¥æ“´å±•
3. **é–‹æºåå¥½**ï¼šé¿å…å•†æ¥­è³‡æ–™åº«é–å®š
4. **ç‰¹æ®ŠæŸ¥è©¢**ï¼šé—œè¯å¼æ¨¡å‹ä¸é©åˆçš„å ´æ™¯
5. **å‹•æ…‹ Schema**ï¼šæ•æ·é–‹ç™¼éœ€è¦å½ˆæ€§

### æ–‡ä»¶æ¨¡å‹çš„æ ¸å¿ƒæ¦‚å¿µ

**è³‡æ–™ä»¥æ–‡ä»¶ç‚ºå–®ä½å„²å­˜ï¼Œé€šå¸¸æ˜¯ JSON**

```json
{
  "user_id": "u123",
  "name": "Alice Chen",
  "email": "alice@example.com",
  "created_at": "2024-01-15",
  "profile": {
    "bio": "Backend Developer",
    "location": "Taipei",
    "skills": ["Python", "Go", "PostgreSQL"]
  },
  "posts": [
    {
      "post_id": "p456",
      "title": "Learning DDIA",
      "content": "Great book!",
      "published_at": "2024-11-01"
    },
    {
      "post_id": "p789",
      "title": "System Design Tips",
      "content": "Start simple...",
      "published_at": "2024-11-10"
    }
  ]
}
```

```mermaid
graph TD
    A["æ–‡ä»¶è³‡æ–™åº«"] --> B["Schema-less"]
    A --> C["åµŒå¥—çµæ§‹"]
    A --> D["å±€éƒ¨æ€§"]
    
    B --> B1["å½ˆæ€§æ¬„ä½"]
    B --> B2["å¿«é€Ÿè¿­ä»£"]
    
    C --> C1["é¿å… JOIN"]
    C --> C2["ä¸€æ¬¡è®€å–"]
    
    D --> D1["ç›¸é—œè³‡æ–™ä¸€èµ·"]
    D --> D2["æ•ˆèƒ½æå‡"]
```

### Object-Relational é˜»æŠ—ä¸åŒ¹é…

**å•é¡Œ**ï¼šæ‡‰ç”¨ç¨‹å¼ä½¿ç”¨ç‰©ä»¶ï¼Œè³‡æ–™åº«ä½¿ç”¨è¡¨æ ¼

**é—œè¯å¼åšæ³•**ï¼šéœ€è¦è½‰æ›å±¤ (ORM)

```python
# Python + SQLAlchemy (ORM)
class User(Base):
    __tablename__ = 'users'
    user_id = Column(Integer, primary_key=True)
    name = Column(String)
    posts = relationship("Post", back_populates="user")

class Post(Base):
    __tablename__ = 'posts'
    post_id = Column(Integer, primary_key=True)
    user_id = Column(Integer, ForeignKey('users.user_id'))
    title = Column(String)
    user = relationship("User", back_populates="posts")

# éœ€è¦é…ç½®è¤‡é›œçš„æ˜ å°„
```

**æ–‡ä»¶å¼åšæ³•**ï¼šç›´æ¥å„²å­˜

```python
# Python + MongoDB
user_doc = {
    "name": "Alice Chen",
    "posts": [
        {"title": "Learning DDIA", "content": "..."},
        {"title": "System Design Tips", "content": "..."}
    ]
}
db.users.insert_one(user_doc)

# è®€å–æ™‚ä¹Ÿæ˜¯å®Œæ•´æ–‡ä»¶
user = db.users.find_one({"name": "Alice Chen"})
print(user["posts"][0]["title"])  # ç›´æ¥å­˜å–
```

### ä¸€å°å¤šé—œä¿‚çš„è™•ç†

**æ¡ˆä¾‹ï¼šLinkedIn å±¥æ­·**

```mermaid
graph TD
    A["å€‹äººè³‡æ–™"] --> B["æ•™è‚²ç¶“æ­·"]
    A --> C["å·¥ä½œç¶“é©—"]
    A --> D["æŠ€èƒ½"]
    
    B --> B1["å°å¤§ 2010-2014"]
    B --> B2["Stanford 2014-2016"]
    
    C --> C1["Google 2016-2020"]
    C --> C2["Meta 2020-ç¾åœ¨"]
```

**é—œè¯å¼æ¨¡å‹**ï¼šå¤šå€‹è¡¨æ ¼ + JOIN

```sql
-- éœ€è¦ 3 å€‹è¡¨æ ¼
CREATE TABLE profiles (
    profile_id INT PRIMARY KEY,
    name VARCHAR(255),
    email VARCHAR(255)
);

CREATE TABLE educations (
    education_id INT PRIMARY KEY,
    profile_id INT REFERENCES profiles(profile_id),
    school VARCHAR(255),
    degree VARCHAR(255),
    start_year INT,
    end_year INT
);

CREATE TABLE experiences (
    experience_id INT PRIMARY KEY,
    profile_id INT REFERENCES profiles(profile_id),
    company VARCHAR(255),
    title VARCHAR(255),
    start_year INT,
    end_year INT
);

-- æŸ¥è©¢éœ€è¦ JOIN
SELECT p.*, e.*, ex.*
FROM profiles p
LEFT JOIN educations e ON p.profile_id = e.profile_id
LEFT JOIN experiences ex ON p.profile_id = ex.profile_id
WHERE p.profile_id = 123;
```

**æ–‡ä»¶æ¨¡å‹**ï¼šä¸€å€‹æ–‡ä»¶åŒ…å«å…¨éƒ¨

```json
{
  "profile_id": 123,
  "name": "Alice Chen",
  "email": "alice@example.com",
  "education": [
    {
      "school": "å°ç£å¤§å­¸",
      "degree": "è³‡è¨Šå·¥ç¨‹å­¸å£«",
      "start_year": 2010,
      "end_year": 2014
    },
    {
      "school": "Stanford University",
      "degree": "Computer Science MS",
      "start_year": 2014,
      "end_year": 2016
    }
  ],
  "experience": [
    {
      "company": "Google",
      "title": "Software Engineer",
      "start_year": 2016,
      "end_year": 2020
    },
    {
      "company": "Meta",
      "title": "Senior SWE",
      "start_year": 2020,
      "end_year": null
    }
  ]
}
```

**æ–‡ä»¶æ¨¡å‹çš„å„ªå‹¢**ï¼š
- âœ… **å±€éƒ¨æ€§ (Locality)**ï¼šç›¸é—œè³‡æ–™å­˜åœ¨ä¸€èµ·ï¼Œä¸€æ¬¡è®€å–
- âœ… **Schema å½ˆæ€§**ï¼šä¸åŒç”¨æˆ¶å¯ä»¥æœ‰ä¸åŒæ¬„ä½
- âœ… **æ›´æ¥è¿‘æ‡‰ç”¨ç¨‹å¼è³‡æ–™çµæ§‹**

### å¤šå°å¤šé—œä¿‚çš„æŒ‘æˆ°

**å•é¡Œ**ï¼šç•¶é—œä¿‚è®Šè¤‡é›œæ™‚

```mermaid
graph TD
    A["ç”¨æˆ¶"] -.-> B["æ‰€åœ¨åŸå¸‚"]
    A -.-> C["å·¥ä½œç”¢æ¥­"]
    A -.-> D["æŠ€èƒ½æ¨™ç±¤"]
    
    E["ç”¨æˆ¶ Alice"] --> B1["Taipei"]
    F["ç”¨æˆ¶ Bob"] --> B1
    G["ç”¨æˆ¶ Carol"] --> B1
    
    E --> C1["Software"]
    F --> C1
    
    E --> D1["Python"]
    F --> D1
    E --> D2["Go"]
    F --> D2
```

**æ–‡ä»¶æ¨¡å‹çš„å›°å¢ƒ**ï¼š

```json
// æ–¹æ¡ˆ 1: é‡è¤‡è³‡æ–™
{
  "user_id": "alice",
  "name": "Alice Chen",
  "location": {
    "city": "Taipei",
    "country": "Taiwan",
    "region": "Asia"  // å¦‚æœ Taipei æ”¹åäº†ï¼Ÿ
  }
}

// æ–¹æ¡ˆ 2: ä½¿ç”¨ ID å¼•ç”¨ï¼ˆå¤±å»å±€éƒ¨æ€§å„ªå‹¢ï¼‰
{
  "user_id": "alice",
  "name": "Alice Chen",
  "location_id": "taipei_tw"  // éœ€è¦é¡å¤–æŸ¥è©¢
}
```

**é—œè¯å¼æ¨¡å‹çš„å„ªå‹¢**ï¼šJOIN è™•ç†å¤šå°å¤šå¾ˆè‡ªç„¶

```sql
-- æ­£è¦åŒ–é¿å…é‡è¤‡
CREATE TABLE locations (
    location_id VARCHAR(50) PRIMARY KEY,
    city VARCHAR(100),
    country VARCHAR(100),
    region VARCHAR(100)
);

-- åŸå¸‚æ”¹ååªéœ€æ”¹ä¸€è™•
UPDATE locations 
SET city = 'New Taipei City' 
WHERE location_id = 'taipei_tw';
```

---

## ğŸŒ åœ–æ¨¡å‹ (Graph Model)

### ä½•æ™‚ä½¿ç”¨åœ–è³‡æ–™åº«ï¼Ÿ

**ç•¶å¤šå°å¤šé—œä¿‚è®Šå¾—éå¸¸è¤‡é›œæ™‚**

```mermaid
graph LR
    A["Alice"] -->|æœ‹å‹| B["Bob"]
    B -->|æœ‹å‹| C["Carol"]
    A -->|æœ‹å‹| C
    
    A -->|å·¥ä½œæ–¼| D["Google"]
    C -->|å·¥ä½œæ–¼| D
    
    A -->|ä½åœ¨| E["Taipei"]
    B -->|ä½åœ¨| E
    
    D -->|ä½æ–¼| F["Mountain View"]
    
    B -->|å–œæ­¡| G["Python"]
    A -->|å–œæ­¡| G
```

**é©åˆåœ–æ¨¡å‹çš„å ´æ™¯**ï¼š
- ç¤¾äº¤ç¶²è·¯
- æ¨è–¦ç³»çµ±
- è©æ¬ºæª¢æ¸¬
- çŸ¥è­˜åœ–è­œ
- è·¯å¾‘è¦åŠƒ

### åœ–æ¨¡å‹çš„æ ¸å¿ƒæ¦‚å¿µ

**Property Graph Model** (Neo4j, Neptune)

```cypher
// å‰µå»ºç¯€é»èˆ‡é—œä¿‚ (Cypher èªè¨€)
CREATE (alice:Person {name: "Alice Chen", email: "alice@example.com"})
CREATE (bob:Person {name: "Bob Lin"})
CREATE (google:Company {name: "Google", founded: 1998})
CREATE (taipei:City {name: "Taipei", country: "Taiwan"})

CREATE (alice)-[:FRIEND_OF {since: 2015}]->(bob)
CREATE (alice)-[:WORKS_AT {title: "SWE", since: 2020}]->(google)
CREATE (alice)-[:LIVES_IN]->(taipei)
CREATE (bob)-[:LIVES_IN]->(taipei)
```

### åœ–æŸ¥è©¢çš„å¨åŠ›

**æ¡ˆä¾‹ 1ï¼šæ‰¾å‡ºæœ‹å‹çš„æœ‹å‹**

```cypher
// Cypher: ç°¡æ½”ç›´è§€
MATCH (alice:Person {name: "Alice Chen"})-[:FRIEND_OF]->(friend)
      -[:FRIEND_OF]->(friendOfFriend)
WHERE NOT (alice)-[:FRIEND_OF]->(friendOfFriend)
  AND alice <> friendOfFriend
RETURN friendOfFriend.name, COUNT(*) as mutual_friends
ORDER BY mutual_friends DESC;
```

```sql
-- SQL: éœ€è¦éè¿´ CTEï¼Œè¤‡é›œä¸”æ•ˆèƒ½å·®
WITH RECURSIVE friend_of_friends AS (
  SELECT friend_id, 1 as level
  FROM friendships
  WHERE user_id = 'alice'
  
  UNION
  
  SELECT f.friend_id, fof.level + 1
  FROM friend_of_friends fof
  JOIN friendships f ON fof.friend_id = f.user_id
  WHERE fof.level < 2
)
SELECT ...  -- é‚„éœ€è¦æ›´å¤šéæ¿¾é‚è¼¯
```

**æ¡ˆä¾‹ 2ï¼šæ¨è–¦ç³»çµ±**

```cypher
// æ‰¾å‡ºä½åœ¨åŒåŸå¸‚ã€æœ‰å…±åŒæœ‹å‹ã€åœ¨åŒç”¢æ¥­å·¥ä½œçš„äºº
MATCH (me:Person {name: "Alice Chen"})-[:LIVES_IN]->(city:City)
      <-[:LIVES_IN]-(other:Person)
MATCH (me)-[:FRIEND_OF]-(mutual)-[:FRIEND_OF]-(other)
MATCH (me)-[:WORKS_AT]->(company1:Company)-[:IN_INDUSTRY]->(industry:Industry)
      <-[:IN_INDUSTRY]-(company2:Company)<-[:WORKS_AT]-(other)
WHERE me <> other
  AND NOT (me)-[:FRIEND_OF]-(other)
RETURN other.name, 
       COUNT(DISTINCT mutual) as mutual_friends,
       city.name as shared_city,
       industry.name as shared_industry
ORDER BY mutual_friends DESC
LIMIT 10;
```

### Triple-Store æ¨¡å‹

**RDF (Resource Description Framework)**

æ‰€æœ‰è³‡æ–™è¡¨ç¤ºç‚ºï¼š`(ä¸»è©, è¬‚è©, å—è©)`

```turtle
# Turtle æ ¼å¼
@prefix : <http://example.com/> .

:alice  a               :Person .
:alice  :name           "Alice Chen" .
:alice  :email          "alice@example.com" .
:alice  :friendOf       :bob .
:alice  :worksAt        :google .
:alice  :livesIn        :taipei .

:google a               :Company .
:google :name           "Google" .
:google :founded        "1998"^^xsd:integer .

:taipei a               :City .
:taipei :name           "Taipei" .
:taipei :country        "Taiwan" .
```

**SPARQL æŸ¥è©¢èªè¨€**

```sparql
# æ‰¾å‡ºä½åœ¨åŒåŸå¸‚çš„åŒäº‹
PREFIX : <http://example.com/>

SELECT ?colleague ?city_name
WHERE {
  :alice :worksAt ?company .
  ?colleague :worksAt ?company .
  ?colleague :livesIn ?city .
  :alice :livesIn ?city .
  ?city :name ?city_name .
  FILTER (?colleague != :alice)
}
```

---

## ğŸ”„ æŸ¥è©¢èªè¨€çš„æ¼”é€²

### å‘½ä»¤å¼ vs è²æ˜å¼

```mermaid
graph TD
    A["æŸ¥è©¢æ–¹å¼"] --> B["å‘½ä»¤å¼<br/>Imperative"]
    A --> C["è²æ˜å¼<br/>Declarative"]
    
    B --> B1["æè¿°å¦‚ä½•åš"]
    B --> B2["é€æ­¥åŸ·è¡Œ"]
    B --> B3["ç¨‹å¼ç¢¼æ§åˆ¶"]
    
    C --> C1["æè¿°æƒ³è¦ä»€éº¼"]
    C --> C2["ç³»çµ±å„ªåŒ–"]
    C --> C3["ä¸¦è¡Œå‹å–„"]
```

**å‘½ä»¤å¼ç¯„ä¾‹ (JavaScript)**

```javascript
// æ‰¾å‡ºæ‰€æœ‰ä½åœ¨ Taipei çš„ç”¨æˆ¶
function getUsersInTaipei(users) {
  const result = [];
  for (let i = 0; i < users.length; i++) {
    if (users[i].location.city === "Taipei") {
      result.push(users[i]);
    }
  }
  return result;
}

// ä½ å‘Šè¨´é›»è…¦ï¼š
// 1. å‰µå»ºç©ºé™£åˆ—
// 2. éæ­·æ¯å€‹ç”¨æˆ¶
// 3. æª¢æŸ¥æ¢ä»¶
// 4. ç¬¦åˆå°±åŠ å…¥çµæœ
// 5. è¿”å›çµæœ
```

**è²æ˜å¼ç¯„ä¾‹ (SQL)**

```sql
-- æè¿°æƒ³è¦ä»€éº¼
SELECT * FROM users WHERE location_city = 'Taipei';

-- è³‡æ–™åº«æ±ºå®šï¼š
-- - æ˜¯å¦ä½¿ç”¨ç´¢å¼•
-- - æƒæé †åº
-- - ä¸¦è¡ŒåŸ·è¡Œ
-- - æŸ¥è©¢è¨ˆç•«å„ªåŒ–
```

**è²æ˜å¼çš„å„ªå‹¢**ï¼š

1. **æ›´ç°¡æ½”**ï¼šç¨‹å¼ç¢¼æ›´çŸ­ï¼Œæ„åœ–æ›´æ¸…æ™°
2. **å¯å„ªåŒ–**ï¼šç³»çµ±å¯è‡ªå‹•å„ªåŒ–åŸ·è¡Œ
3. **ä¸¦è¡Œå‹å–„**ï¼šæ²’æœ‰æŒ‡å®šé †åºï¼Œå®¹æ˜“ä¸¦è¡ŒåŒ–
4. **æŠ½è±¡å±¤**ï¼šåº•å±¤å¯¦ä½œå¯æ”¹é€²ï¼Œä¸å½±éŸ¿æŸ¥è©¢

### MapReduce æŸ¥è©¢

**ä»‹æ–¼å‘½ä»¤å¼èˆ‡è²æ˜å¼ä¹‹é–“**

```javascript
// MongoDB MapReduce ç¯„ä¾‹
// çµ±è¨ˆæ¯å€‹åŸå¸‚çš„ç”¨æˆ¶æ•¸

db.users.mapReduce(
  // Map å‡½æ•¸ï¼šè¼¸å‡º (key, value)
  function map() {
    emit(this.location.city, 1);
  },
  
  // Reduce å‡½æ•¸ï¼šèšåˆç›¸åŒ key çš„ values
  function reduce(key, values) {
    return Array.sum(values);
  },
  
  {
    out: "city_user_counts"
  }
);
```

```mermaid
graph LR
    A["åŸå§‹è³‡æ–™"] --> B["Map éšæ®µ"]
    B --> C["Alice â†’ Taipei: 1"]
    B --> D["Bob â†’ Taipei: 1"]
    B --> E["Carol â†’ Tokyo: 1"]
    
    C --> F["Shuffle & Sort"]
    D --> F
    E --> F
    
    F --> G["Reduce éšæ®µ"]
    G --> H["Taipei: 2"]
    G --> I["Tokyo: 1"]
```

**è²æ˜å¼ç‰ˆæœ¬ (MongoDB Aggregation Pipeline)**

```javascript
// æ›´ç¾ä»£ã€æ›´è²æ˜å¼çš„å¯«æ³•
db.users.aggregate([
  {
    $group: {
      _id: "$location.city",
      count: { $sum: 1 }
    }
  }
]);
```

---

## âš–ï¸ è³‡æ–™æ¨¡å‹çš„é¸æ“‡æŒ‡å—

### æ±ºç­–æ¨¹

```mermaid
graph TD
    A["é¸æ“‡è³‡æ–™æ¨¡å‹"] --> B{è³‡æ–™é—œä¿‚?}
    
    B -->|ä¸€å°å¤š<br/>æ¨¹ç‹€çµæ§‹| C["æ–‡ä»¶æ¨¡å‹"]
    B -->|å¤šå°å¤š<br/>ä½†ç°¡å–®| D["é—œè¯å¼æ¨¡å‹"]
    B -->|å¤šå°å¤š<br/>æ¥µè¤‡é›œ| E["åœ–æ¨¡å‹"]
    
    C --> C1["MongoDB"]
    C --> C2["CouchDB"]
    
    D --> D1["PostgreSQL"]
    D --> D2["MySQL"]
    
    E --> E1["Neo4j"]
    E --> E2["Neptune"]
```

### å ´æ™¯å°ç…§è¡¨

| å ´æ™¯ | æ¨è–¦æ¨¡å‹ | ç†ç”± |
|-----|---------|------|
| éƒ¨è½æ ¼ã€CMS | æ–‡ä»¶ | æ–‡ç« çµæ§‹å®Œæ•´ï¼Œä¸€æ¬¡è®€å– |
| é›»å•†è¨‚å–® | é—œè¯å¼ | è¤‡é›œäº¤æ˜“ï¼ŒACID ä¿è­‰ |
| ç¤¾äº¤ç¶²è·¯ | åœ– | è¤‡é›œé—œä¿‚ï¼Œè·¯å¾‘æŸ¥è©¢ |
| åˆ†æå ±è¡¨ | é—œè¯å¼ | å¼·å¤§çš„èšåˆèˆ‡ JOIN |
| å³æ™‚æ¨è–¦ | åœ– | å¿«é€Ÿè·¯å¾‘æŸ¥è©¢ |
| ä½¿ç”¨è€…è¨­å®š | æ–‡ä»¶ | Schema å½ˆæ€§ |
| é‡‘èäº¤æ˜“ | é—œè¯å¼ | å¼·ä¸€è‡´æ€§éœ€æ±‚ |

### æ··åˆä½¿ç”¨ç­–ç•¥

**ç¾ä»£æ‡‰ç”¨å¸¸ä½¿ç”¨å¤šç¨®è³‡æ–™åº«**

```mermaid
graph TB
    API["API å±¤"]
    
    API --> PG["PostgreSQL<br/>äº¤æ˜“è³‡æ–™"]
    API --> Mongo["MongoDB<br/>ç”¨æˆ¶è¨­å®š"]
    API --> Neo4j["Neo4j<br/>ç¤¾äº¤é—œä¿‚"]
    API --> ES["Elasticsearch<br/>å…¨æ–‡æœå°‹"]
    API --> Redis["Redis<br/>å¿«å–"]
    
    PG -.->|CDC| Kafka["Kafka"]
    Kafka --> ES
    Kafka --> Neo4j
```

**Polyglot Persistenceï¼ˆå¤šèªè³‡æ–™æŒä¹…åŒ–ï¼‰**

```yaml
æ‡‰ç”¨å ´æ™¯:
  ç”¨æˆ¶è³‡æ–™:
    å„²å­˜: PostgreSQL
    åŸå› : ACID, çµæ§‹åŒ–
    
  ç”¨æˆ¶æ´»å‹•æ—¥èªŒ:
    å„²å­˜: MongoDB
    åŸå› : å¯«å…¥é‡å¤§, Schema å½ˆæ€§
    
  ç”¢å“æœå°‹:
    å„²å­˜: Elasticsearch
    åŸå› : å…¨æ–‡æœå°‹, å³æ™‚
    
  ç¤¾äº¤åœ–è­œ:
    å„²å­˜: Neo4j
    åŸå› : è¤‡é›œé—œä¿‚æŸ¥è©¢
    
  å·¥ä½œéšæ®µ:
    å„²å­˜: Redis
    åŸå› : é«˜é€Ÿè®€å¯«
```

---

## ğŸ’» å¯¦æˆ°ç¯„ä¾‹

### æ¡ˆä¾‹ï¼šè¨­è¨ˆ Twitter

**è³‡æ–™çµæ§‹åˆ†æ**

```mermaid
graph TD
    A["æ¨æ–‡è³‡æ–™"] --> B["ä¸€å°å¤š"]
    A --> C["å¤šå°å¤š"]
    
    B --> B1["ç”¨æˆ¶ â†’ æ¨æ–‡"]
    B --> B2["æ¨æ–‡ â†’ åª’é«”"]
    
    C --> C1["ç”¨æˆ¶ â† é—œæ³¨ â†’ ç”¨æˆ¶"]
    C --> C2["ç”¨æˆ¶ â† å–œæ­¡ â†’ æ¨æ–‡"]
    C --> C3["æ¨æ–‡ â†’ æ¨™ç±¤"]
```

**æ–¹æ¡ˆ 1ï¼šé—œè¯å¼æ¨¡å‹**

```sql
CREATE TABLE users (
    user_id BIGINT PRIMARY KEY,
    username VARCHAR(15) UNIQUE,
    display_name VARCHAR(50),
    bio TEXT,
    created_at TIMESTAMP
);

CREATE TABLE tweets (
    tweet_id BIGINT PRIMARY KEY,
    user_id BIGINT REFERENCES users(user_id),
    content VARCHAR(280),
    created_at TIMESTAMP,
    retweet_count INT DEFAULT 0,
    like_count INT DEFAULT 0
);

CREATE TABLE follows (
    follower_id BIGINT REFERENCES users(user_id),
    following_id BIGINT REFERENCES users(user_id),
    created_at TIMESTAMP,
    PRIMARY KEY (follower_id, following_id)
);

CREATE TABLE likes (
    user_id BIGINT REFERENCES users(user_id),
    tweet_id BIGINT REFERENCES tweets(tweet_id),
    created_at TIMESTAMP,
    PRIMARY KEY (user_id, tweet_id)
);
```

**å„ªé»**ï¼š
- âœ… ä¸€è‡´æ€§å¼·
- âœ… è¤‡é›œæŸ¥è©¢å®¹æ˜“
- âœ… è³‡æ–™æ­£è¦åŒ–

**ç¼ºé»**ï¼š
- âŒ è®€å–é¦–é éœ€è¦å¤§é‡ JOIN
- âŒ æ°´å¹³æ“´å±•å›°é›£

**æ–¹æ¡ˆ 2ï¼šæ–‡ä»¶æ¨¡å‹ï¼ˆå¯¦éš›ä½¿ç”¨ï¼‰**

```json
// æ¨æ–‡æ–‡ä»¶
{
  "tweet_id": 123456789,
  "user": {
    "user_id": 101,
    "username": "alice",
    "display_name": "Alice Chen",
    "avatar_url": "https://..."
  },
  "content": "Learning about data models! #DDIA",
  "created_at": "2024-11-13T10:30:00Z",
  "metrics": {
    "retweet_count": 42,
    "like_count": 128,
    "reply_count": 15
  },
  "hashtags": ["DDIA"],
  "media": [
    {
      "type": "image",
      "url": "https://..."
    }
  ]
}

// ç”¨æˆ¶é¦–é  Timelineï¼ˆé å…ˆè¨ˆç®—ï¼‰
{
  "user_id": 202,
  "timeline": [
    {
      "tweet_id": 123456789,
      "cached_at": "2024-11-13T10:30:01Z"
      // åµŒå…¥å®Œæ•´æ¨æ–‡å…§å®¹
    },
    // ... æ›´å¤šæ¨æ–‡
  ],
  "updated_at": "2024-11-13T10:30:01Z"
}
```

**Twitter çš„å¯¦éš›æ¶æ§‹**ï¼š
- æ¨æ–‡è³‡æ–™ï¼šCassandra + Manhattan (Key-Value Store)
- é¦–é  Timelineï¼šRedis (å¿«å–é å…ˆè¨ˆç®—çš„çµæœ)
- ç¤¾äº¤åœ–è­œï¼šFlockDB (åœ–è³‡æ–™åº«)
- æœå°‹ï¼šElasticsearch

---

## ğŸ¤” æ€è€ƒé¡Œ

### 1. ä½•æ™‚æ‡‰è©²åæ­£è¦åŒ– (Denormalization)ï¼Ÿ

<details>
<summary>ç­”æ¡ˆ</summary>

**åæ­£è¦åŒ–çš„æ™‚æ©Ÿ**ï¼š
- è®€å–é »ç‡ >> å¯«å…¥é »ç‡
- JOIN æˆç‚ºæ•ˆèƒ½ç“¶é ¸
- è³‡æ–™å¾ˆå°‘æ”¹è®Š

**ç¯„ä¾‹**ï¼š
```json
// åæ­£è¦åŒ–ï¼šåµŒå…¥ç”¨æˆ¶åç¨±
{
  "post_id": 123,
  "user_id": 456,
  "author_name": "Alice",  // é‡è¤‡è³‡æ–™
  "content": "..."
}
```

**Trade-off**ï¼š
- âœ… è®€å–å¿«ï¼ˆä¸éœ€ JOINï¼‰
- âŒ è³‡æ–™é‡è¤‡
- âŒ æ›´æ–°æ™‚éœ€åŒæ­¥å¤šè™•ï¼ˆå¦‚ç”¨æˆ¶æ”¹åï¼‰

</details>

### 2. æ–‡ä»¶è³‡æ–™åº«å¦‚ä½•è™•ç†å¤šå°å¤šé—œä¿‚ï¼Ÿ

<details>
<summary>ç­”æ¡ˆ</summary>

**ç­–ç•¥ 1ï¼šåµŒå…¥ ID é™£åˆ—**
```json
{
  "user_id": 123,
  "friend_ids": [456, 789, 101]
}
```
- éœ€è¦é¡å¤–æŸ¥è©¢å–å¾—æœ‹å‹è©³ç´°è³‡æ–™

**ç­–ç•¥ 2ï¼šæ‡‰ç”¨å±¤ JOIN**
```javascript
const user = await db.users.findOne({_id: 123});
const friends = await db.users.find({
  _id: {$in: user.friend_ids}
});
```

**ç­–ç•¥ 3ï¼šä½¿ç”¨é—œè¯å¼è³‡æ–™åº«è™•ç†é—œä¿‚**
- ç”¨æ–‡ä»¶è³‡æ–™åº«å„²å­˜å…§å®¹
- ç”¨é—œè¯å¼è³‡æ–™åº«å„²å­˜é—œä¿‚

</details>

### 3. ä»€éº¼æƒ…æ³ä¸‹åœ–è³‡æ–™åº«æ¯”é—œè¯å¼è³‡æ–™åº«æ›´å¥½ï¼Ÿ

<details>
<summary>ç­”æ¡ˆ</summary>

**åœ–è³‡æ–™åº«å„ªå‹¢å ´æ™¯**ï¼š

1. **å¯è®Šæ·±åº¦æŸ¥è©¢**
   - "æ‰¾å‡ºæˆ‘çš„æœ‹å‹çš„æœ‹å‹çš„æœ‹å‹..."
   - SQL éœ€è¦éè¿´ CTEï¼Œæ•ˆèƒ½å·®

2. **å¤šç¨®é—œä¿‚é¡å‹**
   - æœ‹å‹ã€åŒäº‹ã€å®¶äººã€ç²‰çµ²...
   - æ¯ç¨®é—œä¿‚æœ‰ä¸åŒå±¬æ€§

3. **è·¯å¾‘æŸ¥è©¢**
   - æœ€çŸ­è·¯å¾‘
   - æ‰€æœ‰å¯èƒ½è·¯å¾‘
   - æ¨è–¦é€£çµ

4. **å³æ™‚æŸ¥è©¢éœ€æ±‚**
   - ç¤¾äº¤ç¶²è·¯ã€Œä½ å¯èƒ½èªè­˜ã€
   - è©æ¬ºæª¢æ¸¬
   - å½±éŸ¿åŠ›åˆ†æ

**ç¯„ä¾‹**ï¼šLinkedIn çš„ã€Œä½ å¯èƒ½èªè­˜ã€åŠŸèƒ½ç”¨åœ–è³‡æ–™åº«å¯¦ä½œ
</details>

---

## ğŸ“Š ç¸½çµå°ç…§è¡¨

| ç‰¹æ€§ | é—œè¯å¼ | æ–‡ä»¶ | åœ– |
|-----|-------|------|---|
| **Schema** | åš´æ ¼ | å½ˆæ€§ | åŠçµæ§‹åŒ– |
| **é—œä¿‚** | JOIN | åµŒå…¥/å¼•ç”¨ | åŸç”Ÿé‚Š |
| **æŸ¥è©¢èªè¨€** | SQL | MongoDB QL | Cypher/SPARQL |
| **æ°´å¹³æ“´å±•** | å›°é›£ | å®¹æ˜“ | ä¸­ç­‰ |
| **äº‹å‹™** | å®Œæ•´ ACID | æœ‰é™ | æœ‰é™ |
| **é©åˆå ´æ™¯** | çµæ§‹åŒ–è³‡æ–™ | æ–‡ä»¶/æ¨¹ç‹€ | è¤‡é›œé—œä¿‚ |
| **æŸ¥è©¢å½ˆæ€§** | æ¥µé«˜ | ä¸­ç­‰ | è·¯å¾‘æŸ¥è©¢å¼· |
| **å­¸ç¿’æ›²ç·š** | ä½ï¼ˆå»£æ³›çŸ¥è­˜ï¼‰ | ä¸­ | é«˜ |

---

## ğŸ“š æœ¬ç« ç¸½çµ

### æ ¸å¿ƒè¦é»

1. **æ²’æœ‰æœ€å¥½çš„æ¨¡å‹**ï¼Œåªæœ‰æœ€é©åˆçš„æ¨¡å‹
2. **é—œè¯å¼æ¨¡å‹**ï¼šæˆç†Ÿã€å¼·å¤§ã€é©åˆå¤§å¤šæ•¸å ´æ™¯
3. **æ–‡ä»¶æ¨¡å‹**ï¼šå½ˆæ€§ã€å±€éƒ¨æ€§ã€é©åˆä¸€å°å¤š
4. **åœ–æ¨¡å‹**ï¼šè™•ç†è¤‡é›œé—œä¿‚ã€è·¯å¾‘æŸ¥è©¢
5. **è²æ˜å¼æŸ¥è©¢**å„ªæ–¼å‘½ä»¤å¼ï¼šå¯å„ªåŒ–ã€å¯ä¸¦è¡Œ
6. **ç¾ä»£æ‡‰ç”¨**å¸¸æ··åˆä½¿ç”¨å¤šç¨®è³‡æ–™åº«

### é¸æ“‡å»ºè­°

```yaml
èµ·æ­¥éšæ®µ:
  - é è¨­é¸æ“‡: PostgreSQL
  - åŸå› : æˆç†Ÿã€åŠŸèƒ½å®Œæ•´ã€ç¤¾ç¾¤æ”¯æ´
  - ç­‰å¾…: çœŸå¯¦éœ€æ±‚å‡ºç¾å†è€ƒæ…®å…¶ä»–

ç‰¹æ®Šéœ€æ±‚:
  - å½ˆæ€§ Schema: MongoDB
  - è¤‡é›œé—œä¿‚: Neo4j
  - å…¨æ–‡æœå°‹: Elasticsearch
  - é«˜é€Ÿå¿«å–: Redis
```

### ä¸‹ä¸€ç« é å‘Š

åœ¨ä¸‹ä¸€ç« ã€Šå„²å­˜å¼•æ“åŸç†ã€‹ä¸­ï¼Œæˆ‘å€‘å°‡æ·±å…¥è³‡æ–™åº«å…§éƒ¨ï¼Œç†è§£ï¼š
- è³‡æ–™å¦‚ä½•åœ¨ç£ç¢Ÿä¸Šå„²å­˜
- LSM-Tree vs B-Tree çš„æ¬Šè¡¡
- OLTP vs OLAP çš„å·®ç•°
- ç´¢å¼•çµæ§‹èˆ‡æ•ˆèƒ½å„ªåŒ–

---

## åƒè€ƒè³‡æ–™ (References)

1. Martin Kleppmann, *Designing Data-Intensive Applications*, Chapter 2 (O'Reilly, 2017)
2. Edgar F. Codd, ["A Relational Model of Data for Large Shared Data Banks"](https://www.seas.upenn.edu/~zives/03f/cis550/codd.pdf) (1970)
3. [MongoDB Data Modeling](https://www.mongodb.com/docs/manual/core/data-modeling-introduction/)
4. [Neo4j Graph Database](https://neo4j.com/docs/)
5. [The Cost of a Join](https://www.percona.com/blog/2020/01/10/the-cost-of-a-join/)
6. [Twitter: Scaling Timeline](https://blog.twitter.com/engineering/en_us/topics/infrastructure/2017/the-infrastructure-behind-twitter-scale)
