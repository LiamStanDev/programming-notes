# è³‡æ–™ç·¨ç¢¼èˆ‡æ¼”åŒ–

## ğŸ¯ å­¸ç¿’ç›®æ¨™

æœ¬ç« å°‡å¹«åŠ©ä½ ç†è§£ï¼š
- è³‡æ–™åºåˆ—åŒ–æ ¼å¼çš„æ¼”é€²
- å‘å‰ç›¸å®¹æ€§èˆ‡å‘å¾Œç›¸å®¹æ€§
- Schema æ¼”åŒ–ç­–ç•¥
- ä¸åŒç·¨ç¢¼æ ¼å¼çš„æ¬Šè¡¡
- è³‡æ–™æµæ¨¡å¼

---

## ğŸ’¡ ç‚ºä»€éº¼éœ€è¦ç·¨ç¢¼ï¼Ÿ

**æ‡‰ç”¨ç¨‹å¼ä¸­è³‡æ–™å­˜åœ¨å…©ç¨®å½¢å¼**

```mermaid
graph LR
    A["è¨˜æ†¶é«”ä¸­<br/>ç‰©ä»¶ã€çµæ§‹"] <-->|ç·¨ç¢¼/è§£ç¢¼| B["å‚³è¼¸/å„²å­˜<br/>ä½å…ƒçµ„åºåˆ—"]
    
    A --> A1["æŒ‡æ¨™"]
    A --> A2["è¤‡é›œçµæ§‹"]
    A --> A3["ç¨‹å¼èªè¨€ç‰¹å®š"]
    
    B --> B1["è‡ªåŒ…å«"]
    B --> B2["èˆ‡èªè¨€ç„¡é—œ"]
    B --> B3["å¯æŒä¹…åŒ–"]
```

**ç·¨ç¢¼çš„éœ€æ±‚å ´æ™¯**

```yaml
1. æŒä¹…åŒ–å„²å­˜:
   - å¯«å…¥è³‡æ–™åº«
   - å¯«å…¥æª”æ¡ˆç³»çµ±

2. ç¶²è·¯å‚³è¼¸:
   - REST API
   - RPC å‘¼å«
   - è¨Šæ¯ä½‡åˆ—

3. è·¨èªè¨€é€šè¨Š:
   - å¾®æœå‹™ (Go â†’ Python)
   - å‰å¾Œç«¯ (JS â†” Java)
```

---

## ğŸ” èªè¨€å…§å»ºçš„ç·¨ç¢¼

### å•é¡Œï¼šåªèƒ½åŒèªè¨€ä½¿ç”¨

**ç¯„ä¾‹ï¼šPython Pickle**

```python
import pickle

# ç·¨ç¢¼
user = {"name": "Alice", "age": 25}
encoded = pickle.dumps(user)
# b'\x80\x04\x95\x1e\x00\x00\x00...'

# è§£ç¢¼
decoded = pickle.loads(encoded)
# {"name": "Alice", "age": 25}
```

**å…¶ä»–èªè¨€å…§å»ºç·¨ç¢¼**

```yaml
Java: Serializable
Ruby: Marshal
Python: Pickle
.NET: BinaryFormatter
```

**è‡´å‘½ç¼ºé™·**

```yaml
âŒ å®‰å…¨æ€§å•é¡Œ:
   - å¯åŸ·è¡Œä»»æ„ç¨‹å¼ç¢¼
   - ååºåˆ—åŒ–æ¼æ´å¸¸è¦‹

âŒ è·¨èªè¨€å›°é›£:
   - åªèƒ½åŒèªè¨€ä½¿ç”¨
   - ç‰ˆæœ¬å‡ç´šå•é¡Œ

âŒ æ•ˆèƒ½å·®:
   - ç·¨ç¢¼/è§£ç¢¼æ…¢
   - è³‡æ–™é‡å¤§

âŒ æ¼”åŒ–å›°é›£:
   - Schema ä¸æ˜ç¢º
   - ç›¸å®¹æ€§å·®

çµè«–: ä¸è¦ç”¨æ–¼è·¨ç³»çµ±é€šè¨Šï¼
```

---

## ğŸ“ æ–‡å­—ç·¨ç¢¼æ ¼å¼

### JSONã€XMLã€CSV

**JSON ç¯„ä¾‹**

```json
{
  "user_id": 123,
  "name": "Alice Chen",
  "email": "alice@example.com",
  "created_at": "2024-01-15T10:30:00Z",
  "preferences": {
    "theme": "dark",
    "language": "zh-TW"
  },
  "tags": ["developer", "golang"]
}
```

**å„ªå‹¢**

```yaml
âœ… äººé¡å¯è®€:
   - æ˜“æ–¼é™¤éŒ¯
   - ç›´æ¥æŸ¥çœ‹å…§å®¹

âœ… å»£æ³›æ”¯æ´:
   - å¹¾ä¹æ‰€æœ‰èªè¨€
   - è±å¯Œçš„å·¥å…·

âœ… è·¨å¹³å°:
   - Web æ¨™æº–
   - API å¸¸è¦‹æ ¼å¼

âœ… Schema-less:
   - å½ˆæ€§é«˜
   - å¿«é€Ÿè¿­ä»£
```

**åŠ£å‹¢èˆ‡é™·é˜±**

```yaml
âŒ æ•¸å­—é¡å‹æ¨¡ç³Š:
   JSON: {"value": 123}
   - æ˜¯ int32? int64? float?
   - ç²¾åº¦å•é¡Œ (JavaScript Number é™åˆ¶)

âŒ æ²’æœ‰äºŒé€²åˆ¶æ”¯æ´:
   JSON: {"image": "base64encodedstring..."}
   - éœ€è¦ Base64 ç·¨ç¢¼
   - å¢åŠ  33% å¤§å°

âŒ Schema å¯é¸:
   - æ²’æœ‰å¼·åˆ¶é©—è­‰
   - å®¹æ˜“å‡ºéŒ¯

âŒ å†—é•·:
   - æ¬„ä½åé‡è¤‡
   - æª”æ¡ˆå¤§
```

**æ•¸å­—ç²¾åº¦å•é¡Œç¯„ä¾‹**

```javascript
// JavaScript çš„é™·é˜±
const json = '{"user_id": 9007199254740993}';
const obj = JSON.parse(json);

console.log(obj.user_id);
// 9007199254740992  <- éŒ¯äº†ï¼

// åŸå› : JavaScript Number æ˜¯ IEEE 754 double
// åªèƒ½ç²¾ç¢ºè¡¨ç¤º -(2^53-1) ~ (2^53-1)
```

**è§£æ±ºæ–¹æ¡ˆ**

```json
// æ–¹æ¡ˆ 1: ç”¨å­—ä¸²
{"user_id": "9007199254740993"}

// æ–¹æ¡ˆ 2: ç”¨å°ˆé–€çš„å¤§æ•¸å‡½å¼åº«
// æ–¹æ¡ˆ 3: ç”¨äºŒé€²åˆ¶æ ¼å¼ (Protocol Buffers, Avro)
```

---

## ğŸ”§ äºŒé€²åˆ¶ç·¨ç¢¼æ ¼å¼

### ç‚ºä»€éº¼éœ€è¦äºŒé€²åˆ¶ï¼Ÿ

**å¤§å°æ¯”è¼ƒ**

```json
// JSON: 82 bytes
{
  "user_id": 123,
  "name": "Alice Chen",
  "email": "alice@example.com"
}

// MessagePack: 50 bytes (39% ç¯€çœ)
// Protocol Buffers: 33 bytes (60% ç¯€çœ)
// Avro: 32 bytes (61% ç¯€çœ)
```

### Protocol Buffers (Protobuf)

**ç”± Google é–‹ç™¼**

**å®šç¾© Schema**

```protobuf
// user.proto
syntax = "proto3";

message User {
  int64 user_id = 1;      // æ¬„ä½ç·¨è™Ÿ
  string name = 2;
  string email = 3;
  int32 age = 4;
  repeated string tags = 5;  // é™£åˆ—
}
```

**ç·¨ç¢¼åŸç†**

```mermaid
graph LR
    A["æ¬„ä½ç·¨è™Ÿ 1"] --> B["å‹åˆ¥ varint"]
    A --> C["å€¼ 123"]
    
    D["ç·¨ç¢¼ç‚º"] --> E["08 7B"]
    
    E --> E1["08 = 0000 1000"]
    E1 --> E2["field=1, type=0"]
    E --> E3["7B = 123"]
```

**ç·¨ç¢¼ç´°ç¯€**

```
åŸå§‹è³‡æ–™:
user_id: 123
name: "Alice"

ç·¨ç¢¼ (åå…­é€²åˆ¶):
08 7B                    # field 1, varint, value=123
12 05 41 6C 69 63 65    # field 2, string, length=5, "Alice"

è§£æ:
08 = 00001000
  â†‘â†‘â†‘  â†‘â†‘â†‘
  001  000 = field 1, wire type 0 (varint)

7B = 01111011 = 123

12 = 00010010 = field 2, wire type 2 (length-delimited)
05 = é•·åº¦ 5
41 6C 69 63 65 = "Alice" (UTF-8)
```

**å„ªå‹¢**

```yaml
âœ… ç·Šæ¹Š:
   - æ¬„ä½ç·¨è™Ÿä»£æ›¿æ¬„ä½å
   - Varint ç·¨ç¢¼å°æ•¸å­—

âœ… å¿«é€Ÿ:
   - è§£æç°¡å–®
   - ä¸éœ€è¦å­—ä¸²æ¯”å°

âœ… Schema å®šç¾©:
   - å¼·å‹åˆ¥
   - è‡ªå‹•ç”Ÿæˆç¨‹å¼ç¢¼

âœ… å‘å‰/å‘å¾Œç›¸å®¹:
   - è‰¯å¥½çš„æ¼”åŒ–æ”¯æ´
```

**ä½¿ç”¨ç¯„ä¾‹**

```python
# Python
from user_pb2 import User

# åºåˆ—åŒ–
user = User()
user.user_id = 123
user.name = "Alice"
user.email = "alice@example.com"

binary_data = user.SerializeToString()

# ååºåˆ—åŒ–
user2 = User()
user2.ParseFromString(binary_data)
print(user2.name)  # "Alice"
```

### Apache Thrift

**ç”± Facebook é–‹ç™¼**

```thrift
// user.thrift
struct User {
  1: required i64 userId,
  2: required string name,
  3: optional string email,
  4: optional i32 age
}
```

**å…©ç¨®äºŒé€²åˆ¶ç·¨ç¢¼**

```yaml
BinaryProtocol:
  - å¯è®€æ€§è¼ƒå¥½
  - ç¨å¤§
  
CompactProtocol:
  - æ›´ç·Šæ¹Š
  - é¡ä¼¼ Protobuf
```

### Apache Avro

**ç”± Hadoop ç”Ÿæ…‹é–‹ç™¼**

**Schema å®šç¾©**

```json
{
  "type": "record",
  "name": "User",
  "fields": [
    {"name": "user_id", "type": "long"},
    {"name": "name", "type": "string"},
    {"name": "email", "type": ["null", "string"], "default": null}
  ]
}
```

**é—œéµç‰¹æ€§ï¼šæ²’æœ‰æ¬„ä½ç·¨è™Ÿï¼**

```mermaid
graph TD
    A["Avro ç·¨ç¢¼"] --> B["åªæœ‰å€¼"]
    B --> C["123"]
    B --> D["'Alice'"]
    B --> E["'alice@example.com'"]
    
    F["è§£ç¢¼æ™‚"] --> G["éœ€è¦ Writer Schema"]
    F --> H["éœ€è¦ Reader Schema"]
    
    G --> I["æ¯”å° Schema"]
    H --> I
    I --> J["è§£æè³‡æ–™"]
```

**Avro çš„ç¨ç‰¹ä¹‹è™•**

```yaml
ç·¨ç¢¼:
  - åªå„²å­˜å€¼ï¼Œä¸å„²å­˜å‹åˆ¥æˆ–æ¬„ä½å
  - æœ€ç·Šæ¹Š

è§£ç¢¼:
  - éœ€è¦çŸ¥é“å¯«å…¥æ™‚ç”¨çš„ Schema
  - å¯ä»¥ç”¨ä¸åŒ Schema è®€å– (Schema æ¼”åŒ–)

ä½¿ç”¨å ´æ™¯:
  - å¤§è³‡æ–™ (Hadoop, Spark)
  - æ¯å€‹æª”æ¡ˆå…§åµŒ Schema
  - Schema Registry
```

---

## ğŸ”„ Schema æ¼”åŒ–

### å‘å‰ç›¸å®¹ vs å‘å¾Œç›¸å®¹

```mermaid
graph LR
    A["èˆŠç¨‹å¼ç¢¼"] --> B["æ–°è³‡æ–™"]
    C["æ–°ç¨‹å¼ç¢¼"] --> D["èˆŠè³‡æ–™"]
    
    A -.->|å‘å‰ç›¸å®¹<br/>Forward Compatibility| E["èˆŠç¨‹å¼ç¢¼<br/>èƒ½è®€æ–°è³‡æ–™"]
    
    C -.->|å‘å¾Œç›¸å®¹<br/>Backward Compatibility| F["æ–°ç¨‹å¼ç¢¼<br/>èƒ½è®€èˆŠè³‡æ–™"]
```

**å¯¦éš›å ´æ™¯**

```yaml
æ»¾å‹•å‡ç´š (Rolling Update):
  1. èˆŠç‰ˆæœ¬æœå‹™é‹è¡Œä¸­
  2. éƒ¨ç½²æ–°ç‰ˆæœ¬æœå‹™
  3. æ–°èˆŠç‰ˆæœ¬å…±å­˜
  4. é€æ­¥æ›¿æ›æ‰€æœ‰å¯¦ä¾‹
  
  éœ€æ±‚:
  - æ–°ç¨‹å¼ç¢¼è®€èˆŠè³‡æ–™ (å‘å¾Œç›¸å®¹)
  - èˆŠç¨‹å¼ç¢¼è®€æ–°è³‡æ–™ (å‘å‰ç›¸å®¹)
```

### Protobuf Schema æ¼”åŒ–

**è¦å‰‡**

```yaml
âœ… å…è¨±:
  - æ–°å¢ optional æ¬„ä½
  - æ–°å¢ repeated æ¬„ä½
  - åˆªé™¤ optional æ¬„ä½ (æ¬„ä½ç·¨è™Ÿä¸èƒ½é‡ç”¨)

âŒ ç¦æ­¢:
  - æ”¹è®Šæ¬„ä½å‹åˆ¥
  - æ”¹è®Šæ¬„ä½ç·¨è™Ÿ
  - æ–°å¢ required æ¬„ä½
```

**æ¼”åŒ–ç¯„ä¾‹**

```protobuf
// Version 1
message User {
  int64 user_id = 1;
  string name = 2;
}

// Version 2: æ–°å¢å¯é¸æ¬„ä½
message User {
  int64 user_id = 1;
  string name = 2;
  string email = 3;        // âœ… æ–°å¢ optional
  repeated string tags = 4; // âœ… æ–°å¢ repeated
  // int32 age = 1;         // âŒ ä¸èƒ½é‡ç”¨ç·¨è™Ÿ 1
}
```

**å‘å¾Œç›¸å®¹æ€§**

```python
# æ–°ç¨‹å¼ç¢¼è®€èˆŠè³‡æ–™
old_data = b'\x08\x7B\x12\x05Alice'  # åªæœ‰ user_id å’Œ name

user = User()
user.ParseFromString(old_data)

print(user.user_id)  # 123
print(user.name)     # "Alice"
print(user.email)    # "" (é è¨­å€¼)
print(user.tags)     # [] (ç©ºé™£åˆ—)
```

**å‘å‰ç›¸å®¹æ€§**

```python
# èˆŠç¨‹å¼ç¢¼è®€æ–°è³‡æ–™
new_data = encode_user_v2()  # åŒ…å« email, tags

user = UserV1()  # èˆŠç‰ˆæœ¬çµæ§‹
user.ParseFromString(new_data)

print(user.user_id)  # 123
print(user.name)     # "Alice"
# email å’Œ tags è¢«å¿½ç•¥ï¼Œä½†è³‡æ–™ä¿ç•™
```

### Avro Schema æ¼”åŒ–

**æ›´å¼·å¤§çš„æ¼”åŒ–èƒ½åŠ›**

```json
// Writer Schema (å¯«å…¥æ™‚)
{
  "type": "record",
  "name": "User",
  "fields": [
    {"name": "user_id", "type": "long"},
    {"name": "name", "type": "string"}
  ]
}

// Reader Schema (è®€å–æ™‚)
{
  "type": "record",
  "name": "User",
  "fields": [
    {"name": "user_id", "type": "long"},
    {"name": "name", "type": "string"},
    {"name": "email", "type": "string", "default": ""}  // æ–°æ¬„ä½
  ]
}
```

**Avro çš„ Schema Resolution**

```mermaid
graph TD
    A["Writer Schema"] --> C["Schema Resolution"]
    B["Reader Schema"] --> C
    
    C --> D["æ¬„ä½å°æ‡‰"]
    D --> E["åç¨±åŒ¹é…"]
    D --> F["å¡«å…¥é è¨­å€¼"]
    D --> G["å¿½ç•¥æœªçŸ¥æ¬„ä½"]
```

**æ¬„ä½é‡æ–°å‘½å**

```json
// Writer Schema
{
  "name": "User",
  "fields": [
    {"name": "full_name", "type": "string"}
  ]
}

// Reader Schema (å¯è®€èˆŠè³‡æ–™)
{
  "name": "User",
  "fields": [
    {
      "name": "name",
      "type": "string",
      "aliases": ["full_name"]  // åˆ¥å
    }
  ]
}
```

---

## ğŸŒŠ è³‡æ–™æµæ¨¡å¼

### 1. è³‡æ–™åº«è³‡æ–™æµ

```mermaid
graph LR
    A["æ‡‰ç”¨ç¨‹å¼ V1"] -->|å¯«å…¥| B[(è³‡æ–™åº«)]
    B -->|è®€å–| C["æ‡‰ç”¨ç¨‹å¼ V2"]
    
    style B fill:#9cf
```

**æŒ‘æˆ°**

```yaml
å•é¡Œ:
  - è³‡æ–™å¯èƒ½å­˜åœ¨æ•¸å¹´
  - ç¨‹å¼ç¢¼æŒçºŒæ¼”åŒ–
  - ç„¡æ³•å¼·åˆ¶åˆ·æ–°æ‰€æœ‰è³‡æ–™

è§£æ±ºæ–¹æ¡ˆ:
  - Schema-less (JSON æ¬„ä½)
  - å‘å¾Œç›¸å®¹
  - è³‡æ–™é·ç§»ç­–ç•¥
```

**LinkedIn çš„åšæ³•**

```sql
-- ä½¿ç”¨ Avro å„²å­˜åœ¨è³‡æ–™åº«
CREATE TABLE users (
  user_id BIGINT PRIMARY KEY,
  data BYTEA  -- Avro ç·¨ç¢¼çš„è³‡æ–™
);

-- Schema å„²å­˜åœ¨ Schema Registry
-- æ¯ç­†è¨˜éŒ„åŒ…å« Schema ID
```

### 2. æœå‹™è³‡æ–™æµ (REST & RPC)

**REST API**

```mermaid
graph LR
    A["Client"] -->|HTTP GET /users/123| B["Server"]
    B -->|JSON Response| A
    
    C["API Gateway"] --> D["User Service"]
    C --> E["Order Service"]
```

**API ç‰ˆæœ¬ç®¡ç†**

```yaml
æ–¹æ³• 1: URL ç‰ˆæœ¬
  GET /v1/users/123
  GET /v2/users/123

æ–¹æ³• 2: Header ç‰ˆæœ¬
  GET /users/123
  Header: Accept: application/vnd.api+json;version=2

æ–¹æ³• 3: å…§å®¹å”å•†
  GET /users/123
  Header: Accept: application/vnd.user.v2+json

æ¨è–¦: URL ç‰ˆæœ¬ (æœ€æ¸…æ™°)
```

**RPC æ¡†æ¶**

```yaml
gRPC:
  - åŸºæ–¼ HTTP/2
  - ä½¿ç”¨ Protobuf
  - å¼·å‹åˆ¥
  - ç¨‹å¼ç¢¼ç”Ÿæˆ

å„ªå‹¢:
  - âœ… æ•ˆèƒ½å¥½
  - âœ… å‹åˆ¥å®‰å…¨
  - âœ… è·¨èªè¨€

åŠ£å‹¢:
  - âŒ èª¿è©¦å›°é›£ (äºŒé€²åˆ¶)
  - âŒ éœ€è¦ç¨‹å¼ç¢¼ç”Ÿæˆ
  - âŒ ç€è¦½å™¨æ”¯æ´å·®
```

**gRPC ç¯„ä¾‹**

```protobuf
// user_service.proto
service UserService {
  rpc GetUser (GetUserRequest) returns (User);
  rpc CreateUser (CreateUserRequest) returns (User);
}

message GetUserRequest {
  int64 user_id = 1;
}

message User {
  int64 user_id = 1;
  string name = 2;
  string email = 3;
}
```

```go
// Go Server
func (s *server) GetUser(ctx context.Context, req *pb.GetUserRequest) (*pb.User, error) {
    user := &pb.User{
        UserId: req.UserId,
        Name:   "Alice",
        Email:  "alice@example.com",
    }
    return user, nil
}
```

### 3. è¨Šæ¯å‚³éè³‡æ–™æµ

```mermaid
graph LR
    A["Producer"] -->|ç™¼å¸ƒè¨Šæ¯| B["è¨Šæ¯ä½‡åˆ—<br/>Kafka/RabbitMQ"]
    B -->|è¨‚é–±| C["Consumer 1"]
    B -->|è¨‚é–±| D["Consumer 2"]
    B -->|è¨‚é–±| E["Consumer 3"]
```

**è¨Šæ¯æ ¼å¼æŒ‘æˆ°**

```yaml
å•é¡Œ:
  - Producer å’Œ Consumer ç¨ç«‹éƒ¨ç½²
  - ç‰ˆæœ¬å¯èƒ½ä¸ä¸€è‡´
  - è¨Šæ¯å¯èƒ½ç©å£“æ•¸å¤©

éœ€æ±‚:
  - å¼·å‘å‰/å‘å¾Œç›¸å®¹
  - Schema ç®¡ç†
```

**Schema Registry**

```mermaid
graph TD
    A["Producer"] -->|1. è¨»å†Š Schema| B["Schema Registry"]
    A -->|2. ç²å¾— Schema ID| C["ç·¨ç¢¼è¨Šæ¯"]
    C -->|3. ç™¼é€ [Schema ID][Data]| D["Kafka"]
    
    E["Consumer"] -->|4. è®€å–è¨Šæ¯| D
    E -->|5. æŸ¥è©¢ Schema ID| B
    B -->|6. è¿”å› Schema| E
    E -->|7. è§£ç¢¼| F["è™•ç†"]
```

**Confluent Schema Registry ç¯„ä¾‹**

```python
from confluent_kafka import avro
from confluent_kafka.avro import AvroProducer

# å®šç¾© Schema
value_schema_str = """
{
  "type": "record",
  "name": "User",
  "fields": [
    {"name": "user_id", "type": "long"},
    {"name": "name", "type": "string"}
  ]
}
"""

# Producer
producer = AvroProducer({
    'bootstrap.servers': 'localhost:9092',
    'schema.registry.url': 'http://localhost:8081'
}, default_value_schema=avro.loads(value_schema_str))

# ç™¼é€è¨Šæ¯ (è‡ªå‹•è¨»å†Š Schema)
producer.produce(topic='users', value={
    'user_id': 123,
    'name': 'Alice'
})
```

---

## âš–ï¸ ç·¨ç¢¼æ ¼å¼æ¯”è¼ƒ

### åŠŸèƒ½å°æ¯”

| ç‰¹æ€§ | JSON | Protobuf | Thrift | Avro |
|-----|------|----------|--------|------|
| **å¯è®€æ€§** | âœ… äººé¡å¯è®€ | âŒ äºŒé€²åˆ¶ | âŒ äºŒé€²åˆ¶ | âŒ äºŒé€²åˆ¶ |
| **ç·Šæ¹Šæ€§** | âŒ å†—é•· | âœ… ç·Šæ¹Š | âœ… ç·Šæ¹Š | âœ… æœ€ç·Šæ¹Š |
| **Schema** | å¯é¸ | å¿…é ˆ | å¿…é ˆ | å¿…é ˆ |
| **æ¼”åŒ–** | å¼± | å¼· | å¼· | æœ€å¼· |
| **ç¨‹å¼ç¢¼ç”Ÿæˆ** | ä¸éœ€è¦ | éœ€è¦ | éœ€è¦ | å¯é¸ |
| **å‹•æ…‹é¡å‹** | âœ… | âŒ | âŒ | âœ… |
| **æ¬„ä½è­˜åˆ¥** | åç¨± | ç·¨è™Ÿ | ç·¨è™Ÿ | åç¨± |

### æ•ˆèƒ½å°æ¯”

```yaml
å¤§å° (1000 ç­†ç”¨æˆ¶è³‡æ–™):
  JSON:     82 KB
  Protobuf: 33 KB (60% å°)
  Avro:     32 KB (61% å°)

ç·¨ç¢¼é€Ÿåº¦:
  JSON:     åŸºæº–
  Protobuf: 5-10x å¿«
  Avro:     3-5x å¿«

è§£ç¢¼é€Ÿåº¦:
  JSON:     åŸºæº–
  Protobuf: 5-10x å¿«
  Avro:     3-5x å¿«

è¨˜æ†¶é«”ä½¿ç”¨:
  - äºŒé€²åˆ¶æ ¼å¼éœ€è¦é¡å¤–çš„ Schema
  - ä½†æ•´é«”ä»æ›´çœ
```

### é¸æ“‡æŒ‡å—

```mermaid
graph TD
    A["é¸æ“‡ç·¨ç¢¼æ ¼å¼"] --> B{éœ€æ±‚?}
    
    B -->|äººé¡å¯è®€<br/>èª¿è©¦æ–¹ä¾¿| C["JSON"]
    B -->|æ•ˆèƒ½é—œéµ<br/>è·¨èªè¨€| D["Protobuf"]
    B -->|å¤§è³‡æ–™<br/>Schema æ¼”åŒ–| E["Avro"]
    
    C --> C1["REST API"]
    C --> C2["é…ç½®æª”æ¡ˆ"]
    
    D --> D1["å¾®æœå‹™ RPC"]
    D --> D2["ç‰©è¯ç¶²"]
    
    E --> E1["Hadoop/Spark"]
    E --> E2["Kafka"]
```

---

## ğŸ’» å¯¦æˆ°ï¼šAPI ç‰ˆæœ¬ç®¡ç†

### æ¡ˆä¾‹ï¼šç”¨æˆ¶ API æ¼”åŒ–

**V1: åˆå§‹ç‰ˆæœ¬**

```json
// GET /v1/users/123
{
  "id": 123,
  "name": "Alice Chen"
}
```

**V2: æ–°å¢æ¬„ä½**

```json
// GET /v2/users/123
{
  "id": 123,
  "name": "Alice Chen",
  "email": "alice@example.com",
  "created_at": "2024-01-15T10:30:00Z"
}
```

**V3: é‡æ§‹çµæ§‹**

```json
// GET /v3/users/123
{
  "user_id": 123,  // æ”¹å
  "profile": {     // åµŒå¥—çµæ§‹
    "name": "Alice Chen",
    "email": "alice@example.com"
  },
  "metadata": {
    "created_at": "2024-01-15T10:30:00Z",
    "updated_at": "2024-11-13T14:20:00Z"
  }
}
```

**å¯¦ä½œç­–ç•¥**

```python
from flask import Flask, jsonify, request

app = Flask(__name__)

def get_user_from_db(user_id):
    # å¾è³‡æ–™åº«ç²å–å®Œæ•´è³‡æ–™
    return {
        'user_id': user_id,
        'name': 'Alice Chen',
        'email': 'alice@example.com',
        'created_at': '2024-01-15T10:30:00Z',
        'updated_at': '2024-11-13T14:20:00Z'
    }

# V1 API: æœ€å°æ¬„ä½
@app.route('/v1/users/<int:user_id>')
def get_user_v1(user_id):
    user = get_user_from_db(user_id)
    return jsonify({
        'id': user['user_id'],
        'name': user['name']
    })

# V2 API: æ–°å¢æ¬„ä½
@app.route('/v2/users/<int:user_id>')
def get_user_v2(user_id):
    user = get_user_from_db(user_id)
    return jsonify({
        'id': user['user_id'],
        'name': user['name'],
        'email': user['email'],
        'created_at': user['created_at']
    })

# V3 API: é‡æ§‹çµæ§‹
@app.route('/v3/users/<int:user_id>')
def get_user_v3(user_id):
    user = get_user_from_db(user_id)
    return jsonify({
        'user_id': user['user_id'],
        'profile': {
            'name': user['name'],
            'email': user['email']
        },
        'metadata': {
            'created_at': user['created_at'],
            'updated_at': user['updated_at']
        }
    })
```

---

## ğŸ¤” æ€è€ƒé¡Œ

### 1. JSON ä¸­å¦‚ä½•è¡¨ç¤ºäºŒé€²åˆ¶è³‡æ–™ï¼Ÿ

<details>
<summary>ç­”æ¡ˆ</summary>

**æ–¹æ³• 1: Base64 ç·¨ç¢¼**
```json
{
  "image": "iVBORw0KGgoAAAANSUhEUgAA..."
}
```
- âŒ å¢åŠ  33% å¤§å°
- âœ… æ¨™æº–æ–¹æ³•

**æ–¹æ³• 2: ä½¿ç”¨ Data URL**
```json
{
  "image": "data:image/png;base64,iVBORw0..."
}
```
- åŒ…å« MIME é¡å‹

**æ–¹æ³• 3: åˆ†é›¢å„²å­˜**
```json
{
  "image_url": "https://cdn.example.com/img123.png"
}
```
- âœ… æœ€ä½³æ–¹æ¡ˆ
- JSON åªå­˜ URL
- äºŒé€²åˆ¶æª”æ¡ˆå–®ç¨å‚³è¼¸

</details>

### 2. ä»€éº¼æ™‚å€™æ‡‰è©²ä½¿ç”¨ gRPC è€Œä¸æ˜¯ RESTï¼Ÿ

<details>
<summary>ç­”æ¡ˆ</summary>

**ä½¿ç”¨ gRPC**ï¼š
- âœ… å¾®æœå‹™å…§éƒ¨é€šè¨Š
- âœ… æ•ˆèƒ½é—œéµè·¯å¾‘
- âœ… éœ€è¦ä¸²æµ (Server/Client Streaming)
- âœ… å¼·å‹åˆ¥éœ€æ±‚

**ä½¿ç”¨ REST**ï¼š
- âœ… å…¬é–‹ API
- âœ… ç€è¦½å™¨ç›´æ¥å‘¼å«
- âœ… éœ€è¦äººé¡å¯è®€
- âœ… ç°¡å–® CRUD

**æ··åˆç­–ç•¥**ï¼š
- å…§éƒ¨æœå‹™ç”¨ gRPC
- å°å¤– API ç”¨ REST
- API Gateway è½‰æ›

</details>

---

## ğŸ“š æœ¬ç« ç¸½çµ

### æ ¸å¿ƒè¦é»

1. **ç·¨ç¢¼ç„¡è™•ä¸åœ¨**ï¼šå„²å­˜ã€å‚³è¼¸éƒ½éœ€è¦
2. **ç›¸å®¹æ€§è‡³é—œé‡è¦**ï¼šæ»¾å‹•å‡ç´šçš„åŸºç¤
3. **æ²’æœ‰å®Œç¾æ ¼å¼**ï¼šæ ¹æ“šå ´æ™¯é¸æ“‡
4. **Schema æ¼”åŒ–**ï¼šç³»çµ±é•·æœŸæ¼”åŒ–çš„é—œéµ

### é¸æ“‡å»ºè­°

```yaml
å…¬é–‹ API:
  - é è¨­: JSON
  - è€ƒæ…®: OpenAPI/Swagger æ–‡ä»¶

å¾®æœå‹™é€šè¨Š:
  - æ¨è–¦: gRPC + Protobuf
  - å‚™é¸: REST + JSON

è¨Šæ¯ä½‡åˆ—:
  - æ¨è–¦: Avro + Schema Registry
  - å‚™é¸: Protobuf

å¤§è³‡æ–™:
  - æ¨è–¦: Avro (Parquet æª”æ¡ˆ)
  - åŸå› : æœ€ä½³å£“ç¸®ã€Schema æ¼”åŒ–

é…ç½®æª”æ¡ˆ:
  - æ¨è–¦: YAML / JSON
  - åŸå› : äººé¡å¯è®€
```

### ä¸‹ä¸€ç« é å‘Š

åœ¨ä¸‹ä¸€ç« ã€Šè³‡æ–™è¤‡è£½ (Replication)ã€‹ä¸­ï¼Œæˆ‘å€‘å°‡é€²å…¥åˆ†æ•£å¼ç³»çµ±é ˜åŸŸï¼Œæ¢è¨ï¼š
- ä¸»å¾è¤‡è£½ã€å¤šä¸»è¤‡è£½ã€ç„¡ä¸»è¤‡è£½
- åŒæ­¥ vs ç•°æ­¥è¤‡è£½
- è¤‡è£½å»¶é²å•é¡Œ
- ä¸€è‡´æ€§ä¿è­‰

---

## åƒè€ƒè³‡æ–™ (References)

1. Martin Kleppmann, *Designing Data-Intensive Applications*, Chapter 4 (O'Reilly, 2017)
2. [Protocol Buffers Documentation](https://protobuf.dev/)
3. [Apache Avro Specification](https://avro.apache.org/docs/current/spec.html)
4. [gRPC Documentation](https://grpc.io/docs/)
5. [Confluent Schema Registry](https://docs.confluent.io/platform/current/schema-registry/)
6. [API Versioning Best Practices](https://www.freecodecamp.org/news/rest-api-best-practices-rest-endpoint-design-examples/)
