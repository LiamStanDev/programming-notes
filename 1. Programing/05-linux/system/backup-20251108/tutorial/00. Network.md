# 1. 網路基本
---
### 1.1 OSI 七層架構

| Layer                         | 描述                                                   |
| ----------------------------- | ---------------------------------------------------- |
| Layer 1 <br>Physical Layer    | 達成 bit 傳輸                                            |
| Layer 2<br>Data-Link Layer    | 封裝成幀<br>e.g. **MAC Frame: 表頭主要為 MAC 地址 (一般稱為網卡卡號)**  |
| Layer 3<br>Network Layer      | 發送主機到目的主機的數據分組與轉發<br>e.g. **IP packet: 表頭主要為 IP 位置** |
| Layer 4<br>Transport Layer    | 達到進程間的通信<br>e.g. **TCP/UDP: 表頭主要為 port 號碼**          |
| Layer 5<br>Seession Layer     | 定義兩個位置間連些通道的連接與掛斷                                    |
| Layer 6<br>Presentation Layer | 將資料格式轉換網路格式，包含資料加密                                   |
| Layer 7<br>Application Layer  | 支持應用程序所需                                             |
### 1.2 協定詳解
#### 二層協定
這邊最重要的就是 Media Access Control (MAC) 的 Frame，Frame 是一個包裹包含目標與來源網卡的卡號，也就是 MAC 地址。
Frame 內容依序如下

| 內容   | 大小 (bytes) |
| ---- | ---------- |
| 前導碼  | 8          |
| 目標位置 | 6          |
| 來源位置 | 6          |
| 資訊欄位 | 2          |
| 主要資料 | 46-1500    |
| 檢查碼  | 4          |
> 每一張網卡都有一個獨一無二的 MAC 地址。
##### Maximum Transmission Unit, MTU
現在標準的乙太網路 Frame 最大可以達到 1500 bytes，MTU 越大可以減少上層 IP packet 需要進行拆裝的消耗，但是需要每一個裝置都能支持這麼大的 MTU。
* 自建網路可以設依據設備取最小的 MTU 來設定
* **外部網路一律使用標準的 1500**

##### 使用 ip link 操作二層參數
```shell
# 顯示 ens01 設備參數
ip link show ens01
# 偽裝 MAC 地址
ip link set ens01 address 52:54:00:ed:63:ff
# 修改 MTU
ip link set ens01 mtu 9000
```
> 以上只是臨時生效，永久生效要使用 nmcli

#### 三層協定
##### IP Packet 詳解
![[Pasted image 20241210152919.png]]
以下列出需要關注的內容:
* Time To Live (TTL): 表示 IP 封包存活的時間，當**經過一個路由器就會減一**，當減至 0 就會被丟棄，範圍為 0 ~ 255。
* Protocol Number，常見的如下:
	* 1 : ICMP (Internet Control Message Protocol)
	* 4 : IP (IP in IP encapsulation)
	* 6 : TCP (Transmission Control Protocol)
	* 17: UDP (User Datagram Protocol)

##### ICMP 協定
ICMP 同樣是透過 IP 封包進行傳輸，用於提供偵測與回報錯誤的機制。
可以使用 `ping` 與 `traceroute` 來透過 ICMP 封包來檢查網路狀態。

#### 四層協定
##### TCP 協定
##### UDP 協定

# 2. 網路連線命令
---
### 2.1 暫時修改網路參數
##### 使用 ifconfig 操作網卡參數
```shell

```

##### 使用 route 建立路由表
```shell
```
##### 使用 /etc/resolv.conf 修改 DNS IP
```shell
```

##### 使用 hostnamectl 修改主機名
```shell
```

##### 編輯 /etc/hosts 主機名暱稱
```shell
```


### 2.2 網路偵錯


### 2.3 NetworkManager 管理網路連線
自從 REHL 7 後，就預設啟用 NetworkManager 服務來管理網路連線。
```shell
# 確認 NetworkManager 服務
systemctl status NetworkManager
```


# 3. 防火牆
---
### 3.1 防火牆軟體
* Linux 內核支持
	* version 2.4 之後: 使用 iptables
	* version 3.13 之後: 可以選用 iptables/nftables 
		* nftables 是為了支持 IPv6 而生，現在也是推薦使用 nftables
* RHEL 發行版本提供
	* iptables
	* nftables
	* firewalld: 簡單的工具可以建立防火牆，目前推薦使用在單機系統

### 3.2 iptables
因為 REHL 使用 nftables，但有提供 `iptables-nft` 這個軟件包(需要下載)，使用 iptables 命令本質上是使用 nftables。
```shell
# 啟動 iptables
systemctl disable --now firewalld
systemctl disable --now nftables
systemctl enable --now iptables
```

### 3.3 firewalld


### 3.4 nftables
目前的 Linux 系統，核心已經轉向 nftables，他改進了 iptables 程式碼架構，並提供更彈性的設置。
```shell
systemctl disable --now firewalld
systemctl enable --now nftables
```
nftables 的設定檔位於 `/etc/sysconfig/nftables.conf`，但他默認不啟動，所以要進去反註解第四行。


#### 3.4.1 table and chain
```shell
nft list tables

# 輸出為 
# [表格] [IP 格式] [表格名稱]
table inet nftables_svc
```
IP 格式分為:
* ip: 僅針對 IPv4 的格式做封包分析
* ip6: 僅針對 IPv6 的格式做封包分析
* inet: 可同時針對 IPv4 與 IPv6 的封包作分析
* arp: 主要針對 IPv4 的 ARP (address resolution protocol) 封包做分析
* bridge: 分析來自橋接器裝置的封包
* netdev: 分析來自某個網路卡 (ingress) 的封包


